<!DOCTYPE html>
<html lang="pt-br" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeuroScript - Suíte Clínica Pro (Com Nano Banana)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'], 
                        arial: ['Arial', 'Helvetica', 'sans-serif'], 
                    },
                    colors: {
                        medical: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 900: '#0c4a6e' }
                    },
                    boxShadow: {
                        'paper': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(0,0,0,0.02)',
                        'float-nav': '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)',
                    }
                }
            }
        }
    </script>

    <!-- Ícones e PDF -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .dark body { background-color: #0f172a; }
        
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }

        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(16px); border-bottom: 1px solid rgba(226, 232, 240, 0.6); }
        .dark .glass-panel { background: rgba(15, 23, 42, 0.8); border-bottom: 1px solid rgba(51, 65, 85, 0.5); }

        .tab-content { display: none !important; animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .tab-content.active { display: flex !important; flex-direction: column; height: 100%; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ABAS LATERAIS --- */
        .tab-button {
            @apply flex items-center gap-4 px-6 py-5 text-sm font-bold text-slate-500 hover:text-slate-900 dark:hover:text-white transition-all relative rounded-xl;
        }
        .tab-button.active { @apply bg-white dark:bg-slate-800 text-slate-900 dark:text-white shadow-sm; }
        .tab-button i { @apply w-5 h-5; }

        /* --- MOBILE NAV (FLUTUANTE) --- */
        #mobileBottomNav {
            position: fixed; bottom: 24px; left: 20px; right: 20px; height: 70px;
            background: white; border-radius: 9999px; display: flex; justify-content: space-between;
            align-items: center; padding: 0 30px; box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            z-index: 50; border: 1px solid rgba(226, 232, 240, 0.8);
        }
        .dark #mobileBottomNav { background: #1e293b; border-color: #334155; }

        .nav-icon-btn { color: #94a3b8; transition: color 0.3s; display: flex; align-items: center; justify-content: center; }
        .nav-icon-btn.active { color: #0f172a; }
        .dark .nav-icon-btn.active { color: #fff; }
        .nav-icon-btn i { width: 26px; height: 26px; stroke-width: 2px; }

        .nav-center-btn {
            position: absolute; left: 50%; top: -25px; transform: translateX(-50%);
            width: 60px; height: 60px; background-color: #0f172a; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); border: 6px solid #f8fafc;
            transition: transform 0.2s;
        }
        .dark .nav-center-btn { background-color: #fff; color: #0f172a; border-color: #0f172a; }
        .nav-center-btn:active { transform: translateX(-50%) scale(0.95); }
        .nav-center-btn i { width: 28px; height: 28px; }

        /* --- PAPEL --- */
        .print-area-wrapper { width: 100%; display: flex; justify-content: center; padding-bottom: 100px; overflow: auto; }

        #prescriptionPaper {
            font-family: 'Arial', sans-serif !important; color: #000 !important;
            background: white; transition: all 0.3s ease; position: relative;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        #prescriptionPaper.paper-a5 { width: 148mm; min-height: 210mm; padding: 10mm; }
        #prescriptionPaper.paper-a4-landscape { width: 297mm; min-height: 210mm; padding: 15mm; }

        .doc-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 20px; }
        .doc-logo-area { width: 100px; height: 80px; background: #f8f8f8; border: 1px dashed #ccc; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; }
        .doc-logo-area img { width: 100%; height: 100%; object-fit: contain; }
        .doc-name { font-size: 22pt; font-weight: bold; text-transform: uppercase; line-height: 1.1; }
        .doc-meta { text-align: right; font-size: 10pt; }
        
        .hospital-row { display: flex; align-items: center; border-bottom: 1px solid #ccc; min-height: 32px; width: 100%; }
        .hospital-num { width: 35px; text-align: center; font-weight: bold; border-right: 1px solid #ccc; color: #555; font-size: 10pt; }
        .hospital-input { flex: 1; border: none; outline: none; font-family: 'Arial'; font-size: 12pt; padding: 4px 8px; background: transparent; text-transform: uppercase; width: 100%; }
        
        .doc-footer { margin-top: auto; padding-top: 20px; text-align: center; border-top: 1px solid #eee; font-size: 9pt; }

        #documentPanel.mobile-fullscreen { display: flex !important; position: fixed !important; top: 0; left: 0; right: 0; bottom: 0; z-index: 9999; background: #f8fafc; padding: 0 !important; overflow-y: auto; }
        .dark #documentPanel.mobile-fullscreen { background: #0f172a; }

        .doc-switch-btn { @apply px-4 py-2 text-xs font-bold rounded-lg transition-all border shadow-sm; }
        .doc-switch-btn.active { @apply bg-slate-800 text-white border-slate-800 shadow-md scale-105 dark:bg-white dark:text-slate-900; }
        .doc-switch-btn.inactive { @apply bg-white text-slate-500 border-slate-200 hover:bg-slate-50 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700 dark:hover:bg-slate-700; }
        
        .ai-card { @apply transition-all duration-200 border border-transparent hover:-translate-y-0.5 active:scale-95; }

        @media print {
            @page { margin: 0; size: auto; } 
            body { background: white; } 
            .no-print { display: none !important; }
            .print-container { box-shadow: none !important; margin: 0 !important; transform: none !important; }
            #documentPanel { overflow: visible !important; padding: 0 !important; position: static !important; display: block !important; height: auto !important; }
            #prescriptionPaper { margin: 0 !important; box-shadow: none !important; }
        }
    </style>
</head>
<body class="text-slate-800 dark:text-slate-100 h-screen overflow-hidden flex flex-col">

    <!-- HEADER -->
    <header id="mainHeader" class="w-full z-50 glass-panel h-16 flex items-center justify-between px-6 no-print shrink-0 shadow-sm relative transition-all">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-br from-cyan-400 to-purple-600 rounded-xl flex items-center justify-center shadow-lg shadow-purple-500/20 shrink-0">
                <i data-lucide="brain-circuit" class="text-white w-6 h-6 stroke-[2.5px]"></i>
            </div>
            <div class="flex flex-col justify-center h-full pt-1">
                <h1 class="text-2xl font-bold tracking-tight text-slate-900 dark:text-white">Neuro<span class="text-cyan-500 dark:text-cyan-400">Script</span></h1>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <button onclick="app.toggleTheme()" class="p-2.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800/50 transition text-slate-500"><i data-lucide="sun" class="hidden dark:block w-5 h-5"></i><i data-lucide="moon" class="block dark:hidden w-5 h-5"></i></button>
            <button onclick="app.openModal('configModal')" class="p-2.5 hover:bg-slate-100 dark:hover:bg-slate-800/50 rounded-xl transition relative text-slate-600"><i data-lucide="settings" class="w-5 h-5"></i><span id="apiKeyStatus" class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full ring-2 ring-white dark:ring-slate-900 shadow-sm"></span></button>
            <button onclick="app.generatePDF()" class="bg-slate-900 hover:bg-black text-white px-5 py-2.5 rounded-xl text-sm font-bold flex gap-2 items-center transition shadow-lg hidden md:flex hover:-translate-y-0.5"><i data-lucide="printer" class="w-4 h-4"></i> Imprimir</button>
        </div>
    </header>

    <!-- MAIN -->
    <main class="flex flex-col flex-1 overflow-hidden max-w-[1920px] mx-auto w-full relative">
        
        <!-- Desktop Nav -->
        <div class="no-print hidden lg:flex border-b border-slate-200 dark:border-slate-800 px-6 bg-white/60 dark:bg-slate-950/60 backdrop-blur-md z-20 justify-between items-center">
            <div class="flex space-x-1">
                <button onclick="app.switchTab('patient')" id="tabButton-patient" class="tab-button group active">
                    <div class="flex items-center gap-2"><i data-lucide="user-circle-2"></i> Paciente</div>
                </button>
                <button onclick="app.switchTab('ai')" id="tabButton-ai" class="tab-button group">
                    <div class="flex items-center gap-2"><i data-lucide="sparkles"></i> IA Clínica</div>
                </button>
                <button onclick="app.switchTab('pharmacy')" id="tabButton-pharmacy" class="tab-button group">
                    <div class="flex items-center gap-2"><i data-lucide="pill"></i> Farmácia</div>
                </button>
                <button onclick="app.switchTab('exams')" id="tabButton-exams" class="tab-button group">
                    <div class="flex items-center gap-2"><i data-lucide="microscope"></i> Exames</div>
                </button>
            </div>
            <div id="loadingIndicator" class="hidden items-center gap-2 px-3 py-1 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-full text-xs font-bold animate-pulse"><i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i> Buscando...</div>
        </div>

        <div class="flex flex-col lg:flex-row flex-1 overflow-hidden relative">
            
            <!-- LEFT PANEL -->
            <div id="leftPanelContainer" class="flex-1 overflow-y-auto custom-scrollbar p-4 md:p-6 lg:border-r border-slate-200 dark:border-slate-800 h-full bg-white/30 dark:bg-slate-900/30 transition-all duration-300 pb-32 lg:pb-6">
                
                <!-- TAB: PATIENT -->
                <div id="tabContent-patient" class="tab-content active flex-col gap-6">
                    <div class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 p-6">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h2 class="text-sm font-bold text-slate-900 dark:text-white uppercase tracking-wider mb-1 flex items-center gap-2"><i data-lucide="fingerprint" class="w-4 h-4 text-slate-400"></i> Identificação</h2>
                                <p class="text-xs text-slate-500">Registro clínico (SOAP)</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="app.openModal('obstetricModal')" class="flex items-center gap-2 px-3 py-2 bg-pink-50 text-pink-600 dark:bg-pink-900/20 dark:text-pink-300 rounded-xl text-xs font-bold hover:bg-pink-100 transition border border-pink-100 dark:border-pink-800"><i data-lucide="baby" class="w-4 h-4"></i> Calc. IG</button>
                                <button onclick="app.openMagicSoap()" class="group flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl text-xs font-bold shadow-lg shadow-indigo-500/20 hover:shadow-indigo-500/40 hover:scale-105 transition-all active:scale-95"><i data-lucide="wand-2" class="w-3 h-3 group-hover:rotate-12 transition-transform"></i> Magic SOAP</button>
                                <button onclick="app.clearPatientData()" class="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                            </div>
                        </div>

                        <div class="relative mb-6 group">
                            <input type="text" id="patientNameInput" oninput="app.updateDocumentView()" placeholder="Nome do paciente..." class="block w-full pl-3 pr-3 py-3 border border-slate-200 dark:border-slate-700 rounded-xl leading-5 bg-slate-50 dark:bg-slate-800 placeholder-slate-400 focus:outline-none focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition-all font-medium">
                        </div>

                        <div class="grid grid-cols-1 gap-4">
                            <div class="bg-slate-50/50 dark:bg-slate-800/30 rounded-xl p-4 border border-slate-200 dark:border-slate-700 hover:border-indigo-400 transition-colors">
                                <label class="text-[10px] font-bold text-indigo-600 dark:text-indigo-400 uppercase tracking-wider mb-2 flex items-center gap-1.5"><div class="w-1.5 h-1.5 bg-indigo-500 rounded-full"></div> S - Subjetivo</label>
                                <textarea id="soapS" class="w-full bg-transparent text-sm resize-none outline-none min-h-[100px] placeholder-slate-400/50" placeholder="Queixa principal..."></textarea>
                            </div>
                            <div class="bg-slate-50/50 dark:bg-slate-800/30 rounded-xl p-4 border border-slate-200 dark:border-slate-700 hover:border-emerald-400 transition-colors relative group">
                                <div class="flex justify-between items-center mb-2">
                                    <label class="text-[10px] font-bold text-emerald-600 dark:text-emerald-400 uppercase tracking-wider flex items-center gap-1.5"><div class="w-1.5 h-1.5 bg-emerald-500 rounded-full"></div> O - Objetivo</label>
                                    <button onclick="document.getElementById('examUploadInput').click()" class="text-[10px] flex items-center gap-1 text-slate-500 hover:text-emerald-600 transition bg-white dark:bg-slate-800 px-2.5 py-1 rounded-lg border border-slate-200 dark:border-slate-600 shadow-sm"><i data-lucide="paperclip" class="w-3 h-3"></i> Anexar</button>
                                    <input type="file" id="examUploadInput" multiple accept="image/*,application/pdf" class="hidden" onchange="app.handleExamUpload(this)">
                                </div>
                                <textarea id="soapO" class="w-full bg-transparent text-sm resize-none outline-none min-h-[100px] placeholder-slate-400/50" placeholder="Exame físico..."></textarea>
                            </div>
                            <div class="bg-slate-50/50 dark:bg-slate-800/30 rounded-xl p-4 border border-slate-200 dark:border-slate-700 hover:border-orange-400 transition-colors">
                                <label class="text-[10px] font-bold text-orange-600 dark:text-orange-400 uppercase tracking-wider mb-2 flex items-center gap-1.5"><div class="w-1.5 h-1.5 bg-orange-500 rounded-full"></div> A - Avaliação</label>
                                <textarea id="soapA" class="w-full bg-transparent text-sm resize-none outline-none min-h-[80px] placeholder-slate-400/50" placeholder="Diagnóstico..."></textarea>
                            </div>
                            <div class="bg-slate-50/50 dark:bg-slate-800/30 rounded-xl p-4 border border-slate-200 dark:border-slate-700 hover:border-blue-400 transition-colors">
                                <label class="text-[10px] font-bold text-blue-600 dark:text-blue-400 uppercase tracking-wider mb-2 flex items-center gap-1.5"><div class="w-1.5 h-1.5 bg-blue-500 rounded-full"></div> P - Plano</label>
                                <textarea id="soapP" class="w-full bg-transparent text-sm resize-none outline-none min-h-[80px] placeholder-slate-400/50" placeholder="Conduta..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: AI TOOLS -->
                <div id="tabContent-ai" class="tab-content flex-col gap-4 h-full">
                    <div class="relative">
                        <input type="text" id="aiToolSearch" oninput="app.filterAITools()" placeholder="Buscar ferramenta..." class="w-full pl-11 pr-4 py-3.5 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl shadow-sm text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition-all font-medium">
                        <i data-lucide="search" class="absolute left-4 top-3.5 w-5 h-5 text-slate-400"></i>
                    </div>
                    <div id="aiToolsContainer" class="flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-8 pb-10 pt-2"></div>
                </div>

                <!-- TAB: PHARMACY -->
                <div id="tabContent-pharmacy" class="tab-content flex-col gap-4 h-full">
                    <div class="relative">
                        <input type="text" id="medSearch" oninput="app.searchDatabase('med', this.value)" placeholder="Buscar medicamento..." class="w-full pl-11 pr-4 py-3.5 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl shadow-sm text-sm focus:ring-2 focus:ring-emerald-500 outline-none transition-all font-medium">
                        <i data-lucide="search" class="absolute left-4 top-3.5 w-5 h-5 text-slate-400"></i>
                    </div>
                    <div id="medicationList" class="flex-1 overflow-y-auto custom-scrollbar pr-1 space-y-2.5 pb-10">
                        <div class="flex flex-col items-center justify-center h-40 text-slate-400 opacity-60"><i data-lucide="database" class="w-10 h-10 mb-2"></i><span class="text-xs font-medium">Digite para buscar</span></div>
                    </div>
                </div>

                <!-- TAB: EXAMS -->
                <div id="tabContent-exams" class="tab-content flex-col gap-4 h-full">
                    <div class="relative">
                        <input type="text" id="examSearch" oninput="app.searchDatabase('exam', this.value)" placeholder="Buscar exame..." class="w-full pl-11 pr-4 py-3.5 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl shadow-sm text-sm focus:ring-2 focus:ring-orange-500 outline-none transition-all font-medium">
                        <i data-lucide="search" class="absolute left-4 top-3.5 w-5 h-5 text-slate-400"></i>
                    </div>
                    <div id="examList" class="flex-1 overflow-y-auto custom-scrollbar pr-1 space-y-2.5 pb-10">
                        <div class="flex flex-col items-center justify-center h-40 text-slate-400 opacity-60"><i data-lucide="database" class="w-10 h-10 mb-2"></i><span class="text-xs font-medium">Digite para buscar</span></div>
                    </div>
                </div>
            </div>

            <!-- RIGHT PANEL: DOCUMENT PREVIEW -->
            <div id="documentPanel" class="hidden lg:flex flex-1 bg-slate-100/80 dark:bg-slate-950/50 border-l border-slate-200 dark:border-slate-800 justify-center overflow-y-auto custom-scrollbar p-8 shrink-0 h-full relative transition-all duration-300 backdrop-blur-sm">
                
                <!-- Mobile Header -->
                <div class="lg:hidden w-full flex items-center justify-between mb-6 pb-4 border-b border-slate-200 dark:border-slate-700">
                    <button onclick="app.toggleMobileDoc()" class="flex items-center gap-2 text-slate-500 font-bold">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i> Voltar
                    </button>
                    <span class="text-sm font-bold uppercase text-slate-400">Visualização</span>
                </div>

                <div class="flex flex-col items-center w-full max-w-full pt-4 lg:pt-0">
                    <div class="flex p-1.5 bg-white dark:bg-slate-900 rounded-xl mb-8 shadow-sm border border-slate-200 dark:border-slate-800 scale-95 lg:scale-100">
                        <button onclick="app.setDocumentMode('prescription')" id="docMode-prescription" class="doc-switch-btn active">Receita</button>
                        <button onclick="app.setDocumentMode('exams')" id="docMode-exams" class="doc-switch-btn inactive">Exames</button>
                        <button onclick="app.setDocumentMode('hospital')" id="docMode-hospital" class="doc-switch-btn inactive">Hospitalar</button>
                    </div>
                    
                    <div class="print-area-wrapper">
                        <div id="prescriptionPaper" class="paper-a5">
                            <!-- Conteúdo Dinâmico -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- MOBILE BOTTOM NAV -->
    <nav id="mobileBottomNav" class="lg:hidden">
        <button onclick="app.switchTab('patient')" id="mb-nav-patient" class="nav-icon-btn active"><i data-lucide="user-circle-2"></i></button>
        <button onclick="app.switchTab('ai')" id="mb-nav-ai" class="nav-icon-btn"><i data-lucide="sparkles"></i></button>
        <button onclick="app.toggleMobileDoc()" id="mb-nav-doc" class="nav-center-btn"><i data-lucide="file-text"></i></button>
        <button onclick="app.switchTab('pharmacy')" id="mb-nav-pharmacy" class="nav-icon-btn"><i data-lucide="pill"></i></button>
        <button onclick="app.switchTab('exams')" id="mb-nav-exams" class="nav-icon-btn"><i data-lucide="microscope"></i></button>
    </nav>

    <!-- Input Hidden para Logo -->
    <input type="file" id="logoUploadInput" accept="image/*" class="hidden" onchange="app.handleLogoUpload(this)">

    <!-- MODALS -->
    <div id="aiModal" class="hidden fixed inset-0 z-[80] bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4">
         <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 w-full max-w-3xl rounded-3xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden ring-1 ring-white/10">
            <div class="p-5 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
                <h3 id="aiModalTitle" class="font-bold text-lg flex items-center gap-2 text-slate-800 dark:text-white">Resultado</h3>
                <button onclick="app.closeModal('aiModal')" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition"><i data-lucide="x" class="w-5 h-5 opacity-50"></i></button>
            </div>
            <div class="p-8 overflow-y-auto custom-scrollbar grow ai-table-container bg-white dark:bg-slate-950">
                <div id="aiModalContent" class="text-sm leading-relaxed text-slate-700 dark:text-slate-300 font-sans"></div>
            </div>
            <div class="p-5 border-t border-slate-200 dark:border-slate-800 flex justify-end gap-2 bg-slate-50 dark:bg-slate-900">
                <button onclick="app.copyAIContent()" class="px-5 py-2.5 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 text-xs font-bold hover:bg-slate-50 dark:hover:bg-slate-700 transition">Copiar</button>
                <button onclick="app.closeModal('aiModal')" class="px-5 py-2.5 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 text-xs font-bold hover:bg-slate-800 transition">Fechar</button>
            </div>
        </div>
    </div>

    <div id="configModal" class="hidden fixed inset-0 z-[60] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center p-4">
         <div class="bg-white dark:bg-slate-900 p-8 rounded-3xl w-full max-w-lg shadow-2xl border border-slate-200 dark:border-slate-800">
            <div class="flex justify-between mb-8 items-center"><h3 class="text-2xl font-bold">Configurações</h3><button onclick="app.closeModal('configModal')" class="p-2"><i data-lucide="x" class="w-6 h-6"></i></button></div>
            <div class="space-y-6">
                <div class="p-5 bg-indigo-50 dark:bg-indigo-900/10 rounded-2xl border border-indigo-100 dark:border-indigo-800/30">
                    <label class="block text-xs font-bold text-indigo-600 mb-3 uppercase">Gemini API Key</label>
                    <input type="password" id="apiKeyInput" placeholder="Cole sua chave aqui..." class="w-full p-3.5 rounded-xl border bg-white dark:bg-slate-950 border-slate-200 dark:border-slate-700 text-sm">
                </div>
                <div class="border-t border-slate-200 pt-6 grid gap-4">
                    <label class="block text-xs font-bold uppercase text-slate-500">Dados Cabeçalho / Rodapé</label>
                    <input id="cfgName" placeholder="Nome Médico" class="w-full p-3 rounded-xl border bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-sm">
                    <input id="cfgCrm" placeholder="CRM / RQE" class="w-full p-3 rounded-xl border bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-sm">
                    <input id="cfgAddress" placeholder="Endereço da Clínica" class="w-full p-3 rounded-xl border bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-sm">
                    <input id="cfgPhone" placeholder="Telefone de Contato" class="w-full p-3 rounded-xl border bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-sm">
                </div>
                <button onclick="app.saveConfig()" class="w-full bg-slate-900 text-white p-4 rounded-xl font-bold mt-2 shadow-lg">Salvar</button>
            </div>
        </div>
    </div>

    <div id="obstetricModal" class="hidden fixed inset-0 z-[100] bg-slate-900/60 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-900 w-full max-w-2xl rounded-3xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden border border-slate-200 dark:border-slate-800">
            <div class="p-5 border-b border-slate-200 dark:border-slate-800 bg-pink-50 dark:bg-pink-900/20 flex justify-between items-center">
                <h3 class="text-lg font-bold text-pink-700 dark:text-pink-400 flex items-center gap-2"><i data-lucide="calculator" class="w-5 h-5"></i> Calculadora de Idade Gestacional</h3>
                <button onclick="app.closeModal('obstetricModal')" class="p-2 rounded-full hover:bg-slate-200 transition"><i data-lucide="x" class="w-5 h-5 text-slate-500"></i></button>
            </div>
            <div class="p-6 overflow-y-auto bg-slate-50/50 dark:bg-slate-950 space-y-6">
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700">
                    <label class="block text-sm font-bold mb-3 flex items-center gap-2"><i data-lucide="calendar" class="w-4 h-4 text-pink-500"></i> DUM</label>
                    <input type="date" id="calcDum" onchange="app.calcObs()" class="w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl bg-slate-50 dark:bg-slate-700 outline-none text-sm">
                    <div class="mt-3 flex justify-between items-center bg-pink-50 dark:bg-pink-900/10 p-3 rounded-lg border border-pink-100 dark:border-pink-900/30">
                        <span class="text-xs font-bold text-pink-700">IG pela DUM</span>
                        <div class="text-right"><div id="resIgDum" class="font-bold text-slate-800 dark:text-white">--</div><div id="resDppDum" class="text-[10px] text-slate-500">DPP: --</div></div>
                    </div>
                </div>
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700">
                    <label class="block text-sm font-bold mb-3 flex items-center gap-2"><i data-lucide="image" class="w-4 h-4 text-indigo-500"></i> USG</label>
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <div><span class="text-[10px] uppercase font-bold text-slate-400">Data Exame</span><input type="date" id="calcUsgDate" onchange="app.calcObs()" class="w-full p-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-700 text-sm"></div>
                        <div class="flex gap-2"><div class="flex-1"><span class="text-[10px] uppercase font-bold text-slate-400">Sem</span><input type="number" id="calcUsgW" onchange="app.calcObs()" class="w-full p-2 border border-slate-200 rounded-lg bg-slate-50 text-sm"></div><div class="flex-1"><span class="text-[10px] uppercase font-bold text-slate-400">Dias</span><input type="number" id="calcUsgD" onchange="app.calcObs()" class="w-full p-2 border border-slate-200 rounded-lg bg-slate-50 text-sm"></div></div>
                    </div>
                    <div class="mt-3 flex justify-between items-center bg-indigo-50 dark:bg-indigo-900/10 p-3 rounded-lg border border-indigo-100 dark:border-indigo-900/30">
                        <span class="text-xs font-bold text-indigo-700">IG pela USG</span>
                        <div class="text-right"><div id="resIgUsg" class="font-bold text-slate-800 dark:text-white">--</div><div id="resDppUsg" class="text-[10px] text-slate-500">DPP: --</div></div>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900 flex justify-end gap-2">
                <button onclick="app.pasteIg('resIgDum')" class="px-4 py-2 bg-white border border-slate-200 rounded-lg text-xs font-bold hover:bg-slate-100">Usar DUM</button>
                <button onclick="app.pasteIg('resIgUsg')" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-xs font-bold hover:bg-indigo-700">Usar USG</button>
            </div>
        </div>
    </div>

    <div id="magicSoapModal" class="hidden fixed inset-0 z-[90] bg-slate-900/60 backdrop-blur-md flex items-center justify-center p-4 transition-opacity">
         <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 w-full max-w-2xl rounded-3xl shadow-2xl flex flex-col p-6">
            <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-xl flex items-center gap-2 text-indigo-600"><i data-lucide="wand-2" class="w-5 h-5"></i> Magic SOAP</h3><button onclick="app.closeModal('magicSoapModal')"><i data-lucide="x" class="w-5 h-5"></i></button></div>
            <textarea id="magicSoapInput" class="w-full h-40 p-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 mb-4 text-sm" placeholder="Cole o texto..."></textarea>
            <button onclick="app.generateMagicSoap()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg">Processar</button>
        </div>
    </div>

    <script>
        // --- BANCO DE DADOS COMPLETO (Mantido) ---
        const COMPRESSED_DB = `M|Topiramato|25mg|1 cp à noite|Neuro
        M|Topiramato|50mg|1 cp à noite|Neuro
        M|Topiramato|100mg|1 cp 12/12h|Neuro
        M|Lamotrigina|25mg|1 cp ao dia|Neuro
        M|Lamotrigina|50mg|1 cp ao dia|Neuro
        M|Lamotrigina|100mg|1 cp 12/12h|Neuro
        M|Carbamazepina|200mg|1 cp 8/8h|Neuro
        M|Carbamazepina|400mg|1 cp 12/12h|Neuro
        M|Oxcarbazepina|300mg|1 cp 12/12h|Neuro
        M|Oxcarbazepina|600mg|1 cp 12/12h|Neuro
        M|Valproato de Sódio|250mg|1 cp 12/12h|Neuro
        M|Valproato de Sódio|500mg|1 cp 12/12h|Neuro
        M|Divalproato de Sódio|250mg|1 cp 12/12h|Neuro
        M|Divalproato de Sódio|500mg|1 cp 12/12h|Neuro
        M|Gabapentina|300mg|1 cp 8/8h|Neuro
        M|Pregabalina|75mg|1 cp 12/12h|Neuro
        M|Pregabalina|150mg|1 cp 12/12h|Neuro
        M|Fenitoína|100mg|1 cp 8/8h|Neuro
        M|Fenobarbital|100mg|1 cp à noite|Neuro
        M|Levetiracetam|500mg|1 cp 12/12h|Neuro
        M|Primidona|100mg|1 cp 12/12h|Neuro
        M|Etossuximida|250mg|1 cp 12/12h|Neuro
        M|Vigabatrina|500mg|1 cp 12/12h|Neuro
        M|Litio|300mg|1 cp 12/12h|Psiquiatria
        M|Risperidona|1mg|1 cp à noite|Psiquiatria
        M|Risperidona|2mg|1 cp à noite|Psiquiatria
        M|Quetiapina|25mg|1 cp à noite|Psiquiatria
        M|Quetiapina|100mg|1 cp à noite|Psiquiatria
        M|Quetiapina XR|50mg|1 cp à noite|Psiquiatria
        M|Olanzapina|5mg|1 cp à noite|Psiquiatria
        M|Olanzapina|10mg|1 cp à noite|Psiquiatria
        M|Clozapina|25mg|1 cp à noite|Psiquiatria
        M|Aripiprazol|10mg|1 cp pela manhã|Psiquiatria
        M|Haloperidol|5mg|1 cp à noite|Psiquiatria
        M|Clorpromazina|100mg|1 cp à noite|Psiquiatria
        M|Levomepromazina|25mg|1 cp à noite|Psiquiatria
        M|Biperideno|2mg|1 cp 12/12h|Psiquiatria
        M|Amitriptilina|25mg|1 cp à noite|Psiquiatria
        M|Amitriptilina|75mg|1 cp à noite|Psiquiatria
        M|Nortriptilina|25mg|1 cp à noite|Psiquiatria
        M|Clomipramina|25mg|1 cp à noite|Psiquiatria
        M|Imipramina|25mg|1 cp à noite|Psiquiatria
        M|Fluoxetina|20mg|1 cp pela manhã|Psiquiatria
        M|Sertralina|50mg|1 cp pela manhã|Psiquiatria
        M|Sertralina|100mg|1 cp pela manhã|Psiquiatria
        M|Paroxetina|20mg|1 cp pela manhã|Psiquiatria
        M|Citalopram|20mg|1 cp pela manhã|Psiquiatria
        M|Escitalopram|10mg|1 cp pela manhã|Psiquiatria
        M|Escitalopram|20mg|1 cp pela manhã|Psiquiatria
        M|Venlafaxina|75mg|1 cp pela manhã|Psiquiatria
        M|Venlafaxina|150mg|1 cp pela manhã|Psiquiatria
        M|Desvenlafaxina|50mg|1 cp pela manhã|Psiquiatria
        M|Desvenlafaxina|100mg|1 cp pela manhã|Psiquiatria
        M|Duloxetina|30mg|1 cp pela manhã|Psiquiatria
        M|Duloxetina|60mg|1 cp pela manhã|Psiquiatria
        M|Bupropiona|150mg|1 cp pela manhã|Psiquiatria
        M|Bupropiona XL|150mg|1 cp pela manhã|Psiquiatria
        M|Mirtazapina|15mg|1 cp à noite|Psiquiatria
        M|Mirtazapina|30mg|1 cp à noite|Psiquiatria
        M|Trazodona|50mg|1 cp à noite|Psiquiatria
        M|Trazodona|100mg|1 cp à noite|Psiquiatria
        M|Agomelatina|25mg|1 cp à noite|Psiquiatria
        M|Vortioxetina|10mg|1 cp pela manhã|Psiquiatria
        M|Zolpidem|10mg|1 cp ao deitar|Psiquiatria
        M|Eszopiclona|3mg|1 cp ao deitar|Psiquiatria
        M|Zopiclona|7.5mg|1 cp ao deitar|Psiquiatria
        M|Ramelteona|8mg|1 cp ao deitar|Psiquiatria
        M|Diazepam|5mg|1 cp à noite|Psiquiatria
        M|Diazepam|10mg|1 cp à noite|Psiquiatria
        M|Clonazepam|0.5mg|1 cp à noite|Psiquiatria
        M|Clonazepam|2mg|1 cp à noite|Psiquiatria
        M|Alprazolam|0.5mg|1 cp à noite|Psiquiatria
        M|Alprazolam|1mg|1 cp à noite|Psiquiatria
        M|Lorazepam|1mg|1 cp à noite|Psiquiatria
        M|Lorazepam|2mg|1 cp à noite|Psiquiatria
        M|Bromazepam|3mg|1 cp à noite|Psiquiatria
        M|Clobazam|10mg|1 cp à noite|Psiquiatria
        M|Midazolam|15mg|1 cp ao deitar|Psiquiatria
        M|Losartana|50mg|1 cp 12/12h|Cardio
        M|Losartana|100mg|1 cp ao dia|Cardio
        M|Valsartana|160mg|1 cp ao dia|Cardio
        M|Valsartana|320mg|1 cp ao dia|Cardio
        M|Candesartana|8mg|1 cp ao dia|Cardio
        M|Telmisartana|40mg|1 cp ao dia|Cardio
        M|Telmisartana|80mg|1 cp ao dia|Cardio
        M|Olmesartana|20mg|1 cp ao dia|Cardio
        M|Olmesartana|40mg|1 cp ao dia|Cardio
        M|Enalapril|10mg|1 cp 12/12h|Cardio
        M|Enalapril|20mg|1 cp 12/12h|Cardio
        M|Captopril|25mg|1 cp 8/8h|Cardio
        M|Ramipril|5mg|1 cp ao dia|Cardio
        M|Ramipril|10mg|1 cp ao dia|Cardio
        M|Lisinopril|10mg|1 cp ao dia|Cardio
        M|Perindopril|4mg|1 cp ao dia|Cardio
        M|Anlodipino|5mg|1 cp ao dia|Cardio
        M|Anlodipino|10mg|1 cp ao dia|Cardio
        M|Nifedipino|20mg|1 cp 12/12h|Cardio
        M|Levonlodipino|2.5mg|1 cp ao dia|Cardio
        M|Felodipino|5mg|1 cp ao dia|Cardio
        M|Verapamil|80mg|1 cp 8/8h|Cardio
        M|Diltiazem|60mg|1 cp 8/8h|Cardio
        M|Atenolol|25mg|1 cp ao dia|Cardio
        M|Atenolol|50mg|1 cp ao dia|Cardio
        M|Atenolol|100mg|1 cp ao dia|Cardio
        M|Propranolol|40mg|1 cp 12/12h|Cardio
        M|Carvedilol|6.25mg|1 cp 12/12h|Cardio
        M|Carvedilol|12.5mg|1 cp 12/12h|Cardio
        M|Carvedilol|25mg|1 cp 12/12h|Cardio
        M|Bisoprolol|2.5mg|1 cp ao dia|Cardio
        M|Bisoprolol|5mg|1 cp ao dia|Cardio
        M|Bisoprolol|10mg|1 cp ao dia|Cardio
        M|Metoprolol|50mg|1 cp 12/12h|Cardio
        M|Metoprolol|100mg|1 cp ao dia|Cardio
        M|Nebivolol|5mg|1 cp ao dia|Cardio
        M|Sotalol|160mg|1 cp 12/12h|Cardio
        M|Amiodarona|200mg|1 cp ao dia|Cardio
        M|Propafenona|300mg|1 cp 12/12h|Cardio
        M|Digoxina|0.25mg|1/2 cp ao dia|Cardio
        M|Hidroclorotiazida|25mg|1 cp pela manhã|Cardio
        M|Clortalidona|12.5mg|1 cp pela manhã|Cardio
        M|Clortalidona|25mg|1 cp pela manhã|Cardio
        M|Indapamida|1.5mg|1 cp pela manhã|Cardio
        M|Furosemida|40mg|1 cp pela manhã|Cardio
        M|Espironolactona|25mg|1 cp pela manhã|Cardio
        M|Espironolactona|100mg|1 cp ao dia|Cardio
        M|Eplerenona|25mg|1 cp ao dia|Cardio
        M|Amilorida|5mg|1 cp ao dia|Cardio
        M|Clonidina|0.100mg|1 cp 12/12h|Cardio
        M|Metildopa|250mg|1 cp 8/8h|Cardio
        M|Hidralazina|25mg|1 cp 8/8h|Cardio
        M|Minoxidil|10mg|1 cp ao dia|Cardio
        M|Doxazosina|2mg|1 cp à noite|Cardio
        M|Prazosina|1mg|1 cp à noite|Cardio
        M|Tansulosina|0.4mg|1 cp ao dia|Cardio
        M|Sinvastatina|20mg|1 cp à noite|Cardio
        M|Sinvastatina|40mg|1 cp à noite|Cardio
        M|Atorvastatina|10mg|1 cp à noite|Cardio
        M|Atorvastatina|20mg|1 cp à noite|Cardio
        M|Atorvastatina|40mg|1 cp à noite|Cardio
        M|Rosuvastatina|10mg|1 cp à noite|Cardio
        M|Rosuvastatina|20mg|1 cp à noite|Cardio
        M|Pitavastatina|2mg|1 cp à noite|Cardio
        M|Pravastatina|20mg|1 cp à noite|Cardio
        M|Ezetimiba|10mg|1 cp ao dia|Cardio
        M|Fenofibrato|200mg|1 cp ao dia|Cardio
        M|Ciprofibrato|100mg|1 cp ao dia|Cardio
        M|Genfibrozila|600mg|1 cp 12/12h|Cardio
        M|Omega 3|1g|1 cp ao dia|Cardio
        M|AAS|100mg|1 cp após o almoço|Cardio
        M|Clopidogrel|75mg|1 cp após o almoço|Cardio
        M|Ticagrelor|90mg|1 cp 12/12h|Cardio
        M|Prasugrel|10mg|1 cp ao dia|Cardio
        M|Rivaroxabana|15mg|1 cp ao dia|Cardio
        M|Rivaroxabana|20mg|1 cp ao dia|Cardio
        M|Apixabana|2.5mg|1 cp 12/12h|Cardio
        M|Apixabana|5mg|1 cp 12/12h|Cardio
        M|Dabigatrana|110mg|1 cp 12/12h|Cardio
        M|Dabigatrana|150mg|1 cp 12/12h|Cardio
        M|Edoxabana|60mg|1 cp ao dia|Cardio
        M|Varfarina|5mg|Conforme RNI|Cardio
        M|Enoxaparina|40mg|1 seringa SC ao dia|Cardio
        M|Enoxaparina|60mg|1 seringa SC 12/12h|Cardio
        M|Heparina|5000UI|SC 8/8h|Cardio
        M|Nitroglicerina|5mg|Adesivo 1x dia|Cardio
        M|Isossorbida Mononitrato|20mg|1 cp 12/12h|Cardio
        M|Isossorbida Dinitrato|10mg|1 cp 8/8h|Cardio
        M|Propatilnitrato|10mg|1 cp 8/8h|Cardio
        M|Ivabradina|5mg|1 cp 12/12h|Cardio
        M|Sacubitril/Valsartana|49/51mg|1 cp 12/12h|Cardio
        M|Metformina|500mg|1 cp 3x ao dia|Endócrino
        M|Metformina|850mg|1 cp 2x ao dia|Endócrino
        M|Metformina XR|500mg|2 cp no jantar|Endócrino
        M|Metformina XR|1000mg|1 cp no jantar|Endócrino
        M|Glibenclamida|5mg|1 cp no café|Endócrino
        M|Gliclazida MR|30mg|1 cp no café|Endócrino
        M|Gliclazida MR|60mg|1 cp no café|Endócrino
        M|Glimepirida|2mg|1 cp no café|Endócrino
        M|Glimepirida|4mg|1 cp no café|Endócrino
        M|Glipizida|5mg|1 cp no café|Endócrino
        M|Pioglitazona|15mg|1 cp ao dia|Endócrino
        M|Pioglitazona|30mg|1 cp ao dia|Endócrino
        M|Acarbose|50mg|1 cp nas refeições|Endócrino
        M|Sitagliptina|50mg|1 cp ao dia|Endócrino
        M|Sitagliptina|100mg|1 cp ao dia|Endócrino
        M|Vildagliptina|50mg|1 cp 12/12h|Endócrino
        M|Saxagliptina|5mg|1 cp ao dia|Endócrino
        M|Linagliptina|5mg|1 cp ao dia|Endócrino
        M|Alogliptina|25mg|1 cp ao dia|Endócrino
        M|Dapagliflozina|10mg|1 cp ao dia|Endócrino
        M|Empagliflozina|10mg|1 cp ao dia|Endócrino
        M|Empagliflozina|25mg|1 cp ao dia|Endócrino
        M|Canagliflozina|100mg|1 cp ao dia|Endócrino
        M|Canagliflozina|300mg|1 cp ao dia|Endócrino
        M|Liraglutida|6mg/ml|SC diário|Endócrino
        M|Dulaglutida|1.5mg|SC semanal|Endócrino
        M|Semaglutida|0.25mg|SC semanal|Endócrino
        M|Semaglutida|0.5mg|SC semanal|Endócrino
        M|Semaglutida|1mg|SC semanal|Endócrino
        M|Exenatida|2mg|SC semanal|Endócrino
        M|Insulina Regular|UI|Conforme dextro|Endócrino
        M|Insulina NPH|UI|Conforme esquema|Endócrino
        M|Insulina Glargina|UI|SC 1x ao dia|Endócrino
        M|Insulina Detemir|UI|SC 1x ao dia|Endócrino
        M|Insulina Degludeca|UI|SC 1x ao dia|Endócrino
        M|Insulina Asparte|UI|SC nas refeições|Endócrino
        M|Insulina Lispro|UI|SC nas refeições|Endócrino
        M|Insulina Glulisina|UI|SC nas refeições|Endócrino
        M|Levotiroxina|25mcg|1 cp em jejum|Endócrino
        M|Levotiroxina|50mcg|1 cp em jejum|Endócrino
        M|Levotiroxina|75mcg|1 cp em jejum|Endócrino
        M|Levotiroxina|88mcg|1 cp em jejum|Endócrino
        M|Levotiroxina|100mcg|1 cp em jejum|Endócrino
        M|Levotiroxina|112mcg|1 cp em jejum|Endócrino
        M|Levotiroxina|125mcg|1 cp em jejum|Endócrino
        M|Levotiroxina|150mcg|1 cp em jejum|Endócrino
        M|Metimazol|10mg|1 cp ao dia|Endócrino
        M|Propiltiouracil|100mg|1 cp 8/8h|Endócrino
        M|Alendronato|70mg|1 cp semanal em jejum|Endócrino
        M|Risedronato|35mg|1 cp semanal em jejum|Endócrino
        M|Ibandronato|150mg|1 cp mensal em jejum|Endócrino
        M|Ácido Zoledrônico|5mg|IV anual|Endócrino
        M|Denosumabe|60mg|SC semestral|Endócrino
        M|Teriparatida|20mcg|SC diário|Endócrino
        M|Carbonato de Cálcio|500mg|1 cp ao dia|Endócrino
        M|Citrato de Cálcio|500mg|1 cp ao dia|Endócrino
        M|Colecalciferol (Vit D)|7000UI|1 cp semanal|Endócrino
        M|Colecalciferol (Vit D)|50000UI|1 cp semanal (ataque)|Endócrino
        M|Calcitriol|0.25mcg|1 cp ao dia|Endócrino
        M|Omeprazol|20mg|1 cp em jejum|Gastro
        M|Omeprazol|40mg|1 cp em jejum|Gastro
        M|Pantoprazol|20mg|1 cp em jejum|Gastro
        M|Pantoprazol|40mg|1 cp em jejum|Gastro
        M|Lansoprazol|30mg|1 cp em jejum|Gastro
        M|Esomeprazol|20mg|1 cp em jejum|Gastro
        M|Esomeprazol|40mg|1 cp em jejum|Gastro
        M|Rabeprazol|20mg|1 cp em jejum|Gastro
        M|Dexlansoprazol|30mg|1 cp em jejum|Gastro
        M|Dexlansoprazol|60mg|1 cp em jejum|Gastro
        M|Cimetidina|200mg|1 cp 12/12h|Gastro
        M|Famotidina|20mg|1 cp 12/12h|Gastro
        M|Domperidona|10mg|1 cp 15 min antes refeição|Gastro
        M|Metoclopramida|10mg|1 cp 8/8h|Gastro
        M|Bromoprida|10mg|1 cp 8/8h|Gastro
        M|Ondansetrona|4mg|1 cp 8/8h|Gastro
        M|Ondansetrona|8mg|1 cp 8/8h|Gastro
        M|Dimenidrinato|100mg|1 cp 6/6h|Gastro
        M|Meclizina|25mg|1 cp 12/12h|Gastro
        M|Escopolamina (Buscopan)|10mg|1 cp 8/8h|Gastro
        M|Simeticona|40mg|1 cp 6/6h|Gastro
        M|Loperamida|2mg|1 cp se diarreia|Gastro
        M|Racecadotrila|100mg|1 cp 8/8h|Gastro
        M|Lactulose|667mg/ml|15ml 12/12h|Gastro
        M|Bisacodil|5mg|1 cp à noite|Gastro
        M|Picossulfato|Gts|10-20 gotas à noite|Gastro
        M|Óleo Mineral|Liq|15ml à noite|Gastro
        M|Macrogol|Env|1 envelope ao dia|Gastro
        M|Psyllium|Pó|1 colher em água|Gastro
        M|Mesalazina|500mg|1 cp 8/8h|Gastro
        M|Mesalazina|800mg|1 cp 8/8h|Gastro
        M|Sulfassalazina|500mg|1 cp 6/6h|Gastro
        M|Ursodesoxicolico|300mg|1 cp 12/12h|Gastro
        M|Pancreatina|Cp|1 cp nas refeições|Gastro
        M|Amoxicilina|500mg|1 cp 8/8h|Infecto
        M|Amoxicilina|875mg|1 cp 12/12h|Infecto
        M|Amoxicilina+Clavulanato|500+125mg|1 cp 8/8h|Infecto
        M|Amoxicilina+Clavulanato|875+125mg|1 cp 12/12h|Infecto
        M|Ampicilina|500mg|1 cp 6/6h|Infecto
        M|Penicilina G Benzatina|1.200.000UI|IM dose única|Infecto
        M|Oxacilina|500mg|1 cp 6/6h|Infecto
        M|Cefalexina|500mg|1 cp 6/6h|Infecto
        M|Cefadroxila|500mg|1 cp 12/12h|Infecto
        M|Cefuroxima|500mg|1 cp 12/12h|Infecto
        M|Ceftriaxona|1g|IV/IM 1x ao dia|Infecto
        M|Cefepima|1g|IV 12/12h|Infecto
        M|Azitromicina|500mg|1 cp ao dia|Infecto
        M|Claritromicina|500mg|1 cp 12/12h|Infecto
        M|Eritromicina|500mg|1 cp 6/6h|Infecto
        M|Clindamicina|300mg|1 cp 6/6h|Infecto
        M|Gentamicina|80mg|IM/IV 1x ao dia|Infecto
        M|Amicacina|500mg|IM/IV 1x ao dia|Infecto
        M|Ciprofloxacino|500mg|1 cp 12/12h|Infecto
        M|Levofloxacino|500mg|1 cp ao dia|Infecto
        M|Levofloxacino|750mg|1 cp ao dia|Infecto
        M|Norfloxacino|400mg|1 cp 12/12h|Infecto
        M|Moxifloxacino|400mg|1 cp ao dia|Infecto
        M|Sulfametoxazol+Trimetoprima|400+80mg|2 cp 12/12h|Infecto
        M|Sulfametoxazol+Trimetoprima|800+160mg|1 cp 12/12h|Infecto
        M|Nitrofurantoína|100mg|1 cp 6/6h|Infecto
        M|Fosfomicina|3g|1 envelope dose única|Infecto
        M|Metronidazol|250mg|2 cp 12/12h|Infecto
        M|Metronidazol|400mg|1 cp 8/8h|Infecto
        M|Doxiciclina|100mg|1 cp 12/12h|Infecto
        M|Tetraciclina|500mg|1 cp 6/6h|Infecto
        M|Vancomicina|1g|IV 12/12h|Infecto
        M|Teicoplanina|400mg|IV 1x ao dia|Infecto
        M|Linezolida|600mg|1 cp 12/12h|Infecto
        M|Meropenem|1g|IV 8/8h|Infecto
        M|Imipenem|500mg|IV 6/6h|Infecto
        M|Ertapenem|1g|IV 1x ao dia|Infecto
        M|Polimixina B|UI|IV conforme peso|Infecto
        M|Fluconazol|150mg|1 cp dose única|Infecto
        M|Itraconazol|100mg|1 cp 12/12h|Infecto
        M|Cetoconazol|200mg|1 cp ao dia|Infecto
        M|Voriconazol|200mg|1 cp 12/12h|Infecto
        M|Nistatina|Susp|Bochechar 4x dia|Infecto
        M|Miconazol|Creme|Aplicar 2x dia|Infecto
        M|Anfotericina B|mg|IV conforme peso|Infecto
        M|Aciclovir|200mg|1 cp 4/4h|Infecto
        M|Aciclovir|400mg|1 cp 12/12h|Infecto
        M|Valaciclovir|500mg|1 cp 12/12h|Infecto
        M|Oseltamivir|75mg|1 cp 12/12h|Infecto
        M|Tenofovir|300mg|1 cp ao dia|Infecto
        M|Lamivudina|150mg|1 cp 12/12h|Infecto
        M|Efavirenz|600mg|1 cp à noite|Infecto
        M|Dolutegravir|50mg|1 cp ao dia|Infecto
        M|Salbutamol|Spray|2 jatos 4/4h se crise|Pneumo
        M|Fenoterol|Gts|Inalação conforme peso|Pneumo
        M|Formoterol|Cap|Inalar 1 cap 12/12h|Pneumo
        M|Salmeterol|Spray|2 jatos 12/12h|Pneumo
        M|Ipratrópio|Gts|Inalação conforme peso|Pneumo
        M|Tiotrópio|Cap|Inalar 1 cap ao dia|Pneumo
        M|Budesonida|Spray|2 jatos nasais 12/12h|Pneumo
        M|Beclometasona|Spray|2 jatos nasais 12/12h|Pneumo
        M|Fluticasona|Spray|2 jatos nasais ao dia|Pneumo
        M|Mometasona|Spray|2 jatos nasais ao dia|Pneumo
        M|Ciclesonida|Spray|2 jatos nasais ao dia|Pneumo
        M|Prednisona|5mg|1 cp pela manhã|Pneumo
        M|Prednisona|20mg|1 cp pela manhã|Pneumo
        M|Prednisolona|20mg|1 cp pela manhã|Pneumo
        M|Dexametasona|4mg|1 cp ao dia|Pneumo
        M|Betametasona|IM|Dose única|Pneumo
        M|Hidrocortisona|IV|Conforme peso|Pneumo
        M|Metilprednisolona|IV|Conforme peso|Pneumo
        M|Loratadina|10mg|1 cp ao dia|Pneumo
        M|Desloratadina|5mg|1 cp ao dia|Pneumo
        M|Fexofenadina|120mg|1 cp ao dia|Pneumo
        M|Fexofenadina|180mg|1 cp ao dia|Pneumo
        M|Cetirizina|10mg|1 cp ao dia|Pneumo
        M|Levocetirizina|5mg|1 cp ao dia|Pneumo
        M|Hidroxizina|25mg|1 cp à noite|Pneumo
        M|Dexclorfeniramina|2mg|1 cp 8/8h|Pneumo
        M|Prometazina|25mg|1 cp à noite|Pneumo
        M|Montelucaste|10mg|1 cp à noite|Pneumo
        M|Acebrofilina|Xpe|10ml 12/12h|Pneumo
        M|Ambroxol|Xpe|5ml 8/8h|Pneumo
        M|N-Acetilcisteína|600mg|1 env à noite|Pneumo
        M|Guaifenesina|Xpe|10ml 4/4h|Pneumo
        M|Dipirona|500mg|1 cp 6/6h|Dor
        M|Dipirona|1g|1 cp 6/6h|Dor
        M|Paracetamol|500mg|1 cp 6/6h|Dor
        M|Paracetamol|750mg|1 cp 6/6h|Dor
        M|Ibuprofeno|600mg|1 cp 8/8h|Dor
        M|Naproxeno|500mg|1 cp 12/12h|Dor
        M|Cetoprofeno|100mg|1 cp 12/12h|Dor
        M|Diclofenaco|50mg|1 cp 8/8h|Dor
        M|Aceclofenaco|100mg|1 cp 12/12h|Dor
        M|Meloxicam|15mg|1 cp ao dia|Dor
        M|Piroxicam|20mg|1 cp ao dia|Dor
        M|Tenoxicam|20mg|1 cp ao dia|Dor
        M|Celecoxibe|200mg|1 cp ao dia|Dor
        M|Etoricoxibe|90mg|1 cp ao dia|Dor
        M|Parecoxibe|40mg|IV/IM 12/12h|Dor
        M|Codeína|30mg|1 cp 6/6h|Dor
        M|Tramadol|50mg|1 cp 8/8h|Dor
        M|Morfina|10mg|1 cp 4/4h|Dor
        M|Metadona|10mg|1 cp 8/8h|Dor
        M|Oxicodona|10mg|1 cp 12/12h|Dor
        M|Fentanil|Adesivo|Trocar a cada 72h|Dor
        M|Buprenorfina|Adesivo|Trocar a cada 7 dias|Dor
        M|Ciclobenzaprina|5mg|1 cp à noite|Dor
        M|Ciclobenzaprina|10mg|1 cp à noite|Dor
        M|Tizanidina|2mg|1 cp 8/8h|Dor
        M|Carisoprodol|1 cp|1 cp 8/8h|Dor
        M|Orfenadrina|35mg|1 cp 8/8h|Dor
        M|Baclofeno|10mg|1 cp 8/8h|Dor
        M|Colchicina|0.5mg|1 cp 12/12h na crise|Reumato
        M|Alopurinol|100mg|1 cp ao dia|Reumato
        M|Alopurinol|300mg|1 cp ao dia|Reumato
        M|Febuxostate|80mg|1 cp ao dia|Reumato
        M|Metotrexato|2.5mg|Semanal|Reumato
        M|Leflunomida|20mg|1 cp ao dia|Reumato
        M|Hidroxicloroquina|400mg|1 cp ao dia|Reumato
        M|Cloroquina|150mg|1 cp ao dia|Reumato
        M|Azatioprina|50mg|1 cp ao dia|Reumato
        M|Ciclosporina|100mg|1 cp 12/12h|Reumato
        M|Etinilestradiol+Levonorgestrel|Cp|1 cp ao dia|Gineco
        M|Ciproterona|2mg|1 cp ao dia|Gineco
        M|Desogestrel|75mcg|1 cp ao dia|Gineco
        M|Gestodeno|75mcg|1 cp ao dia|Gineco
        M|Drospirenona|3mg|1 cp ao dia|Gineco
        M|Medroxiprogesterona|150mg|IM trimestral|Gineco
        M|Noretisterona|0.35mg|1 cp ao dia|Gineco
        M|Levonorgestrel (PDS)|1.5mg|Dose única|Gineco
        M|Estradiol|1mg|1 cp ao dia|Gineco
        M|Estriol|Creme|Aplicar vaginal|Gineco
        M|Promestrieno|Creme|Aplicar vaginal|Gineco
        M|Testosterona|Gel|Aplicar na pele|Endócrino
        M|Sildenafila|50mg|1 cp 1h antes|Uro
        M|Tadalafila|5mg|1 cp ao dia|Uro
        M|Tadalafila|20mg|1 cp antes relação|Uro
        M|Vardenafila|20mg|1 cp antes relação|Uro
        M|Finasterida|5mg|1 cp ao dia|Uro
        M|Dutasterida|0.5mg|1 cp ao dia|Uro
        M|Doxazosina|2mg|1 cp à noite|Uro
        M|Doxazosina|4mg|1 cp à noite|Uro
        M|Tansulosina|0.4mg|1 cp ao dia|Uro
        M|Oxibutinina|5mg|1 cp 8/8h|Uro
        M|Solifenacina|5mg|1 cp ao dia|Uro
        M|Darifenacina|7.5mg|1 cp ao dia|Uro
        M|Mirabegrona|50mg|1 cp ao dia|Uro
        M|Permetrina|Loção|Aplicar no corpo|Dermato
        M|Ivermectina|6mg|Conforme peso|Dermato
        M|Tiabendazol|Pmd|Aplicar na lesão|Dermato
        M|Albendazol|400mg|1 cp dose única|Dermato
        M|Mebendazol|100mg|1 cp 12/12h 3 dias|Dermato
        M|Neomicina+Bacitracina|Pmd|Aplicar na lesão|Dermato
        M|Sulfadiazina de Prata|Creme|Aplicar na queimadura|Dermato
        M|Colagenase|Pmd|Aplicar na lesão|Dermato
        M|Hidrocortisona|Creme|Aplicar na lesão|Dermato
        M|Betametasona|Creme|Aplicar na lesão|Dermato
        M|Clobetasol|Creme|Aplicar na lesão|Dermato
        M|Desonida|Creme|Aplicar na lesão|Dermato
        M|Mometasona|Creme|Aplicar na lesão|Dermato
        M|Adapaleno|Gel|Aplicar à noite|Dermato
        M|Tretinoína|Creme|Aplicar à noite|Dermato
        M|Isotretinoína|20mg|1 cp ao dia|Dermato
        M|Peróxido de Benzoíla|Gel|Aplicar na acne|Dermato
        M|Clindamicina tópica|Gel|Aplicar na acne|Dermato
        M|Eritromicina tópica|Gel|Aplicar na acne|Dermato
        M|Cetoconazol shampoo|Liq|Lavar couro cabeludo|Dermato
        M|Selênio|Shampoo|Lavar couro cabeludo|Dermato
        E|Hemograma Completo|Lab|Sangue
        E|Glicemia de Jejum|Lab|Sangue
        E|Hemoglobina Glicada (HbA1c)|Lab|Sangue
        E|Colesterol Total|Lab|Sangue
        E|HDL Colesterol|Lab|Sangue
        E|LDL Colesterol|Lab|Sangue
        E|VLDL Colesterol|Lab|Sangue
        E|Triglicerídeos|Lab|Sangue
        E|Ureia|Lab|Sangue
        E|Creatinina|Lab|Sangue
        E|Sódio|Lab|Sangue
        E|Potássio|Lab|Sangue
        E|Cálcio Total|Lab|Sangue
        E|Cálcio Iônico|Lab|Sangue
        E|Magnésio|Lab|Sangue
        E|Fósforo|Lab|Sangue
        E|Ácido Úrico|Lab|Sangue
        E|TGO (AST)|Lab|Sangue
        E|TGP (ALT)|Lab|Sangue
        E|Gama GT|Lab|Sangue
        E|Fosfatase Alcalina|Lab|Sangue
        E|Bilirrubina Total e Frações|Lab|Sangue
        E|Amilase|Lab|Sangue
        E|Lipase|Lab|Sangue
        E|Proteínas Totais e Frações|Lab|Sangue
        E|Albumina|Lab|Sangue
        E|TSH|Lab|Sangue
        E|T4 Livre|Lab|Sangue
        E|T3 Total|Lab|Sangue
        E|T3 Livre|Lab|Sangue
        E|Anti-TPO|Lab|Sangue
        E|TRAB|Lab|Sangue
        E|LH|Lab|Sangue
        E|FSH|Lab|Sangue
        E|Estradiol|Lab|Sangue
        E|Progesterona|Lab|Sangue
        E|Testosterona Total|Lab|Sangue
        E|Testosterona Livre|Lab|Sangue
        E|Prolactina|Lab|Sangue
        E|Cortisol Basal|Lab|Sangue
        E|PTH|Lab|Sangue
        E|Vitamina B12|Lab|Sangue
        E|Vitamina D (25-OH)|Lab|Sangue
        E|Ácido Fólico|Lab|Sangue
        E|Ferritina|Lab|Sangue
        E|Ferro Sérico|Lab|Sangue
        E|Capacidade de Ligação do Ferro|Lab|Sangue
        E|Saturação de Transferrina|Lab|Sangue
        E|PSA Total|Lab|Sangue
        E|PSA Livre|Lab|Sangue
        E|CA-125|Lab|Sangue
        E|CEA|Lab|Sangue
        E|CA 19-9|Lab|Sangue
        E|Alfa-fetoproteína|Lab|Sangue
        E|Beta HCG Quantitativo|Lab|Sangue
        E|HIV 1 e 2 (Sorologia)|Lab|Sangue
        E|VDRL|Lab|Sangue
        E|FTA-ABS|Lab|Sangue
        E|HBsAg|Lab|Sangue
        E|Anti-HBs|Lab|Sangue
        E|Anti-HBc Total|Lab|Sangue
        E|Anti-HCV|Lab|Sangue
        E|Sorologia Dengue IgM/IgG|Lab|Sangue
        E|Sorologia Chikungunya IgM/IgG|Lab|Sangue
        E|Sorologia Zika IgM/IgG|Lab|Sangue
        E|Sorologia Toxoplasmose IgM/IgG|Lab|Sangue
        E|Sorologia Rubéola IgM/IgG|Lab|Sangue
        E|Sorologia CMV IgM/IgG|Lab|Sangue
        E|Epstein-Barr IgM/IgG|Lab|Sangue
        E|Proteína C Reativa (PCR)|Lab|Sangue
        E|VHS|Lab|Sangue
        E|Fator Reumatoide|Lab|Sangue
        E|FAN (Hep-2)|Lab|Sangue
        E|Anti-DNA|Lab|Sangue
        E|Anti-Ro|Lab|Sangue
        E|Anti-La|Lab|Sangue
        E|Anti-CCP|Lab|Sangue
        E|ASLO|Lab|Sangue
        E|Complemento C3|Lab|Sangue
        E|Complemento C4|Lab|Sangue
        E|EAS (Urina Tipo 1)|Lab|Urina
        E|Urocultura com Antibiograma|Lab|Urina
        E|Microalbuminúria|Lab|Urina
        E|Proteinúria de 24h|Lab|Urina
        E|Parasitológico de Fezes|Lab|Fezes
        E|Sangue Oculto nas Fezes|Lab|Fezes
        E|Coprocultura|Lab|Fezes
        E|RX Tórax PA e Perfil|Img|Raio-X
        E|RX Seios da Face|Img|Raio-X
        E|RX Abdome Agudo|Img|Raio-X
        E|RX Abdome Simples|Img|Raio-X
        E|RX Coluna Cervical|Img|Raio-X
        E|RX Coluna Torácica|Img|Raio-X
        E|RX Coluna Lombar|Img|Raio-X
        E|RX Bacia|Img|Raio-X
        E|RX Quadril|Img|Raio-X
        E|RX Joelho|Img|Raio-X
        E|RX Ombro|Img|Raio-X
        E|RX Mãos e Punhos|Img|Raio-X
        E|RX Pé e Tornozelo|Img|Raio-X
        E|USG Abdome Total|Img|Ultrassom
        E|USG Abdome Superior|Img|Ultrassom
        E|USG Vias Urinárias|Img|Ultrassom
        E|USG Pélvica|Img|Ultrassom
        E|USG Transvaginal|Img|Ultrassom
        E|USG Obstétrica|Img|Ultrassom
        E|USG Obstétrica com Doppler|Img|Ultrassom
        E|USG Morfológica 1º Trimestre|Img|Ultrassom
        E|USG Morfológica 2º Trimestre|Img|Ultrassom
        E|USG Tireoide|Img|Ultrassom
        E|USG Tireoide com Doppler|Img|Ultrassom
        E|USG Mamas|Img|Ultrassom
        E|USG Próstata Via Abdominal|Img|Ultrassom
        E|USG Próstata Transretal|Img|Ultrassom
        E|USG Doppler Venoso MMII|Img|Ultrassom
        E|USG Doppler Arterial MMII|Img|Ultrassom
        E|USG Doppler Carótidas e Vertebrais|Img|Ultrassom
        E|TC Crânio|Img|Tomografia
        E|TC Seios da Face|Img|Tomografia
        E|TC Tórax|Img|Tomografia
        E|TC Abdome Total|Img|Tomografia
        E|TC Abdome Superior|Img|Tomografia
        E|TC Pelve|Img|Tomografia
        E|TC Coluna Cervical|Img|Tomografia
        E|TC Coluna Lombar|Img|Tomografia
        E|TC Mastoides|Img|Tomografia
        E|RM Crânio|Img|Ressonância
        E|RM Sela Túrcica|Img|Ressonância
        E|RM Coluna Cervical|Img|Ressonância
        E|RM Coluna Lombar|Img|Ressonância
        E|RM Joelho|Img|Ressonância
        E|RM Ombro|Img|Ressonância
        E|RM Quadril|Img|Ressonância
        E|RM Abdome Superior|Img|Ressonância
        E|RM Pelve|Img|Ressonância
        E|Eletrocardiograma (ECG)|Gf|Cardio
        E|Ecocardiograma Transtorácico|Gf|Cardio
        E|Teste Ergométrico|Gf|Cardio
        E|Holter 24h|Gf|Cardio
        E|MAPA 24h|Gf|Cardio
        E|Cintilografia Miocárdica|Img|Cardio
        E|Angiotomografia de Coronárias|Img|Cardio
        E|Endoscopia Digestiva Alta|Gf|Gastro
        E|Colonoscopia|Gf|Gastro
        E|Espirometria|Gf|Pneumo
        E|Audiometria|Gf|Otorrino
        E|Impedanciometria|Gf|Otorrino
        E|Densitometria Óssea|Gf|Reumato
        E|Mamografia Digital|Img|Gineco`;

      /* BIBLIOTECA ADICIONAL DE IA (200+ NOVAS FERRAMENTAS)
   Basta concatenar este array ao seu array principal:
   const FULL_LIBRARY = [...AI_LIBRARY, ...ADDITIONAL_TOOLS];
*/

const ADDITIONAL_TOOLS = [
    // --- Terapia Intensiva / UTI (Novo) ---
    { id: 'rass_scale', cat: 'UTI', label: 'Escala RASS', icon: 'activity', color: 'indigo', prompt: 'Determine a pontuação na Escala de Sedação e Agitação de Richmond (RASS) para este paciente: {o}.' },
    { id: 'cam_icu', cat: 'UTI', label: 'CAM-ICU', icon: 'brain', color: 'purple', prompt: 'Aplique o algoritmo CAM-ICU para detecção de Delirium com base nestes dados: {o}.' },
    { id: 'apache_ii', cat: 'UTI', label: 'APACHE II', icon: 'bar-chart-2', color: 'red', prompt: 'Estime a mortalidade usando o score APACHE II com estes parâmetros: {o}.' },
    { id: 'saps_3', cat: 'UTI', label: 'SAPS 3', icon: 'bar-chart', color: 'red', prompt: 'Calcule o SAPS 3 para prognóstico de admissão na UTI.' },
    { id: 'pf_ratio', cat: 'UTI', label: 'Relação P/F', icon: 'wind', color: 'blue', prompt: 'Calcule a relação PaO2/FiO2 (Índice de Horowitz) e classifique a gravidade da SDRA. PaO2: {val1}, FiO2: {val2}.' },
    { id: 'fluid_response', cat: 'UTI', label: 'Fluidorresponsiv.', icon: 'droplet', color: 'cyan', prompt: 'Analise os parâmetros dinâmicos (PPV, VVP, USG veia cava) para determinar fluidorresponsividade: {o}.' },
    { id: 'vent_weaning', cat: 'UTI', label: 'Desmame Vent.', icon: 'wind', color: 'green', prompt: 'Avalie os critérios de aptidão para desmame ventilatório (Tobin/RSBI) para este paciente: {o}.' },
    { id: 'nutric_score', cat: 'UTI', label: 'NUTRIC Score', icon: 'carrot', color: 'orange', prompt: 'Calcule o NUTRIC Score para avaliar risco nutricional no paciente crítico.' },
    { id: 'dic_score', cat: 'UTI', label: 'Score CID', icon: 'droplet', color: 'red', prompt: 'Calcule o score da ISTH para Coagulação Intravascular Disseminada (CID).' },
    
    // --- Anestesiologia (Novo) ---
    { id: 'asa_class', cat: 'Anestesia', label: 'Classe ASA', icon: 'user-check', color: 'slate', prompt: 'Classifique o estado físico conforme a ASA (American Society of Anesthesiologists): {s} {o}.' },
    { id: 'mallampati', cat: 'Anestesia', label: 'Mallampati', icon: 'smile', color: 'yellow', prompt: 'Classifique a via aérea segundo Mallampati e preveja dificuldade de intubação: {o}.' },
    { id: 'caprini_score', cat: 'Anestesia', label: 'Score Caprini', icon: 'layers', color: 'red', prompt: 'Avalie o risco de TEV perioperatório usando o Score de Caprini.' },
    { id: 'ponv_risk', cat: 'Anestesia', label: 'Risco NVPO', icon: 'frown', color: 'orange', prompt: 'Calcule o risco de Náuseas e Vômitos Pós-Operatórios (Apfel Score).' },
    { id: 'stop_bang', cat: 'Anestesia', label: 'STOP-Bang', icon: 'moon', color: 'indigo', prompt: 'Rastreio de Apneia Obstrutiva do Sono (STOP-Bang).' },
    { id: 'last_protocol', cat: 'Anestesia', label: 'LAST Protocolo', icon: 'alert-triangle', color: 'red', prompt: 'Conduta imediata para Intoxicação Sistêmica por Anestésico Local (LAST).' },

    // --- Cardiologia (Expansão) ---
    { id: 'score2', cat: 'Cardiologia', label: 'SCORE2', icon: 'heart', color: 'red', prompt: 'Calcule o risco cardiovascular em 10 anos (Europa) usando SCORE2.' },
    { id: 'reynolds_risk', cat: 'Cardiologia', label: 'Reynolds Risk', icon: 'heart', color: 'pink', prompt: 'Score de Risco Reynolds (incluindo PCR e história familiar).' },
    { id: 'duke_criteria', cat: 'Cardiologia', label: 'Duke Endocardite', icon: 'check-square', color: 'red', prompt: 'Aplique os Critérios de Duke Modificados para suspeita de endocardite: {s} {o}.' },
    { id: 'brugada_criteria', cat: 'Cardiologia', label: 'Crit. Brugada', icon: 'activity', color: 'yellow', prompt: 'Analise os critérios ECG para Síndrome de Brugada.' },
    { id: 'sgarbossa', cat: 'Cardiologia', label: 'Sgarbossa', icon: 'activity', color: 'purple', prompt: 'Critérios de Sgarbossa para IAM com BRE novo ou antigo.' },
    { id: 'wellens_sign', cat: 'Cardiologia', label: 'Sinal Wellens', icon: 'activity', color: 'red', prompt: 'Identifique padrões de Síndrome de Wellens no ECG e conduta.' },
    { id: 'lvh_criteria', cat: 'Cardiologia', label: 'Critérios HVE', icon: 'maximize', color: 'indigo', prompt: 'Verifique critérios de Sokolow-Lyon e Cornell para HVE no ECG.' },
    { id: 'canadian_angina', cat: 'Cardiologia', label: 'Angina CCS', icon: 'list', color: 'slate', prompt: 'Classificação da Sociedade Canadense de Cardiologia (CCS) para angina.' },
    { id: 'ehra_score', cat: 'Cardiologia', label: 'Score EHRA', icon: 'activity', color: 'blue', prompt: 'Classificação de sintomas de FA (EHRA).' },
    { id: 'tisdale_score', cat: 'Cardiologia', label: 'Tisdale', icon: 'activity', color: 'orange', prompt: 'Risco de prolongamento QT (Tisdale Score) intra-hospitalar.' },
    { id: 'orbit_score', cat: 'Cardiologia', label: 'ORBIT', icon: 'droplet', color: 'red', prompt: 'Score ORBIT para risco de sangramento em FA (alternativa ao HAS-BLED).' },

    // --- Pneumologia (Expansão) ---
    { id: 'aa_gradient', cat: 'Pneumo', label: 'Gradiente A-a', icon: 'wind', color: 'blue', prompt: 'Calcule o Gradiente Alvéolo-arterial de O2. PaO2: {val}, PaCO2: {val}, FiO2: {val}.' },
    { id: 'bode_index', cat: 'Pneumo', label: 'Índice BODE', icon: 'bar-chart', color: 'slate', prompt: 'Calcule o Índice BODE para prognóstico de DPOC.' },
    { id: 'lcat_score', cat: 'Pneumo', label: 'LCAT', icon: 'crosshair', color: 'gray', prompt: 'Teste de Avaliação de DPOC (CAT Score).' },
    { id: 'mmrc_dyspnea', cat: 'Pneumo', label: 'mMRC Dispneia', icon: 'wind', color: 'cyan', prompt: 'Escala de dispneia mMRC.' },
    { id: 'spn_brock', cat: 'Pneumo', label: 'Modelo Brock', icon: 'circle', color: 'red', prompt: 'Probabilidade de malignidade em nódulo pulmonar (Modelo Brock/PanCan).' },
    { id: 'geneva_pe', cat: 'Pneumo', label: 'Geneva Score', icon: 'alert-circle', color: 'red', prompt: 'Score de Geneva Revisado para TEP.' },
    { id: 'gap_index', cat: 'Pneumo', label: 'Índice GAP', icon: 'activity', color: 'purple', prompt: 'Índice GAP para prognóstico de Fibrose Pulmonar Idiopática.' },

    // --- Neurologia (Expansão) ---
    { id: 'mrs_scale', cat: 'Neuro', label: 'Rankin Modif.', icon: 'user', color: 'slate', prompt: 'Classifique a incapacidade funcional pela Escala de Rankin Modificada (mRS).' },
    { id: 'ich_score', cat: 'Neuro', label: 'ICH Score', icon: 'brain', color: 'red', prompt: 'Prognóstico de Hemorragia Intracerebral (ICH Score).' },
    { id: 'four_score', cat: 'Neuro', label: 'FOUR Score', icon: 'eye', color: 'blue', prompt: 'Escala FOUR de coma (alternativa a Glasgow para intubados).' },
    { id: 'aspects_score', cat: 'Neuro', label: 'ASPECTS', icon: 'grid', color: 'gray', prompt: 'Interprete o score ASPECTS na TC de crânio para AVC isquêmico.' },
    { id: 'mcdonald_ms', cat: 'Neuro', label: 'Crit. McDonald', icon: 'layers', color: 'indigo', prompt: 'Critérios de McDonald para diagnóstico de Esclerose Múltipla.' },
    { id: 'parkinson_stages', cat: 'Neuro', label: 'Hoehn & Yahr', icon: 'user', color: 'orange', prompt: 'Estadiamento de Hoehn & Yahr para Parkinson.' },
    { id: 'migraine_midas', cat: 'Neuro', label: 'MIDAS', icon: 'frown', color: 'purple', prompt: 'Avaliação de incapacidade por enxaqueca (MIDAS).' },
    { id: 'gbs_score', cat: 'Neuro', label: 'Erasmus GBS', icon: 'activity', color: 'blue', prompt: 'Prognóstico na Síndrome de Guillain-Barré (Erasmus GBS Outcome Score).' },

    // --- Nefrologia & Hidroeletrolítico (Expansão) ---
    { id: 'sodium_correction', cat: 'Nefrologia', label: 'Déficit Sódio', icon: 'activity', color: 'blue', prompt: 'Calcule o déficit de sódio e a taxa de reposição segura. Na atual: {val}.' },
    { id: 'water_deficit', cat: 'Nefrologia', label: 'Déficit Água', icon: 'droplet', color: 'cyan', prompt: 'Calcule o déficit de água livre na hipernatremia.' },
    { id: 'calcium_alb', cat: 'Nefrologia', label: 'Cálcio Corrigido', icon: 'calculator', color: 'yellow', prompt: 'Cálcio corrigido pela albumina. Ca: {val}, Alb: {val}.' },
    { id: 'anion_gap', cat: 'Nefrologia', label: 'Anion Gap', icon: 'minus-circle', color: 'red', prompt: 'Calcule o Anion Gap e o Delta Gap para distúrbio misto.' },
    { id: 'winter_formula', cat: 'Nefrologia', label: 'Fórmula Winter', icon: 'wind', color: 'slate', prompt: 'Verifique a compensação respiratória na acidose metabólica (Winter).' },
    { id: 'ttkg', cat: 'Nefrologia', label: 'TTKG', icon: 'percent', color: 'purple', prompt: 'Gradiente Transtubular de Potássio (TTKG) para investigar hipo/hipercalemia.' },
    { id: 'cockcroft_gault', cat: 'Nefrologia', label: 'Cockcroft-Gault', icon: 'calculator', color: 'slate', prompt: 'Clearance de creatinina por Cockcroft-Gault.' },
    { id: 'kidney_stone', cat: 'Nefrologia', label: 'Stone Score', icon: 'circle', color: 'gray', prompt: 'S.T.O.N.E. Nephrolithometry Score para sucesso de ureteroscopia.' },

    // --- Gastroenterologia / Hepatologia (Expansão) ---
    { id: 'mayo_score', cat: 'Gastro', label: 'Mayo Score', icon: 'list', color: 'red', prompt: 'Escore de Mayo para atividade da Retocolite Ulcerativa.' },
    { id: 'cdai_crohn', cat: 'Gastro', label: 'CDAI Crohn', icon: 'activity', color: 'orange', prompt: 'Índice de Atividade da Doença de Crohn (CDAI).' },
    { id: 'rockall_score', cat: 'Gastro', label: 'Rockall Score', icon: 'alert-triangle', color: 'red', prompt: 'Risco de ressangramento em HDA (Score de Rockall).' },
    { id: 'forrest_class', cat: 'Gastro', label: 'Classif. Forrest', icon: 'eye', color: 'red', prompt: 'Classificação de Forrest para úlcera péptica e risco de ressangramento.' },
    { id: 'nafld_score', cat: 'Gastro', label: 'NAFLD Fibrosis', icon: 'filter', color: 'yellow', prompt: 'Score de Fibrose NAFLD (esteatose hepática).' },
    { id: 'maddrey_score', cat: 'Gastro', label: 'Maddrey', icon: 'activity', color: 'purple', prompt: 'Função Discriminante de Maddrey para hepatite alcoólica.' },
    { id: 'lille_model', cat: 'Gastro', label: 'Modelo Lille', icon: 'bar-chart', color: 'indigo', prompt: 'Modelo de Lille para resposta a corticoide na hepatite alcoólica.' },
    { id: 'bristol_scale', cat: 'Gastro', label: 'Escala Bristol', icon: 'image', color: 'brown', prompt: 'Classificação visual das fezes (Escala de Bristol).' },

    // --- Infectologia (Expansão) ---
    { id: 'lrinec_score', cat: 'Infecto', label: 'LRINEC', icon: 'alert-triangle', color: 'red', prompt: 'Score LRINEC para diferenciar celulite de fasciíte necrosante.' },
    { id: 'mascc_index', cat: 'Infecto', label: 'Índice MASCC', icon: 'thermometer', color: 'orange', prompt: 'Avaliação de risco em Neutropenia Febril (MASCC).' },
    { id: 'psi_port', cat: 'Infecto', label: 'PSI/PORT', icon: 'list', color: 'blue', prompt: 'Pneumonia Severity Index (PSI) para decisão de internação.' },
    { id: 'fournier_index', cat: 'Infecto', label: 'FGSI Fournier', icon: 'skull', color: 'black', prompt: 'Índice de Gravidade da Gangrena de Fournier (FGSI).' },
    { id: 'timi_risk_ie', cat: 'Infecto', label: 'Endocardite Risco', icon: 'heart', color: 'red', prompt: 'Avaliação de risco de embolização na Endocardite.' },
    { id: 'vancomycin_auc', cat: 'Infecto', label: 'Vanco AUC/MIC', icon: 'pill', color: 'slate', prompt: 'Cálculo de dose de Vancomicina baseada em AUC/MIC.' },

    // --- Hematologia / Oncologia (Expansão) ---
    { id: 'khorana_score', cat: 'Oncologia', label: 'Khorana', icon: 'alert-circle', color: 'red', prompt: 'Risco de TEV em pacientes com câncer (Score de Khorana).' },
    { id: 'ecog_status', cat: 'Oncologia', label: 'ECOG/Zubrod', icon: 'user', color: 'slate', prompt: 'Performance Status ECOG.' },
    { id: 'karnofsky', cat: 'Oncologia', label: 'Karnofsky', icon: 'percent', color: 'slate', prompt: 'Escala de Performance de Karnofsky (KPS).' },
    { id: 'recist_criteria', cat: 'Oncologia', label: 'RECIST 1.1', icon: 'ruler', color: 'blue', prompt: 'Critérios de resposta em tumores sólidos (RECIST 1.1).' },
    { id: 'ipss_mds', cat: 'Hemato', label: 'IPSS-R', icon: 'bar-chart', color: 'orange', prompt: 'Prognóstico na Síndrome Mielodisplásica (IPSS-R).' },
    { id: 'flipi_score', cat: 'Hemato', label: 'FLIPI', icon: 'layers', color: 'purple', prompt: 'Índice Prognóstico Internacional para Linfoma Folicular.' },
    { id: 'ipi_score', cat: 'Hemato', label: 'IPI Linfoma', icon: 'layers', color: 'indigo', prompt: 'Índice Prognóstico Internacional para Linfoma Difuso de Grandes Células.' },
    { id: 'mentzer_index', cat: 'Hemato', label: 'Índice Mentzer', icon: 'divide', color: 'red', prompt: 'Diferenciar anemia ferropriva de talassemia (Índice de Mentzer).' },

    // --- Trauma e Cirurgia Geral (Expansão) ---
    { id: 'alvarado_score', cat: 'Cirurgia', label: 'Alvarado', icon: 'check-square', color: 'orange', prompt: 'Probabilidade de Apendicite Aguda (Score Alvarado).' },
    { id: 'air_score', cat: 'Cirurgia', label: 'AIR Score', icon: 'check', color: 'yellow', prompt: 'Appendicitis Inflammatory Response (AIR) Score.' },
    { id: 'rts_trauma', cat: 'Cirurgia', label: 'Score RTS', icon: 'ambulance', color: 'red', prompt: 'Revised Trauma Score (RTS) para triagem.' },
    { id: 'iss_score', cat: 'Cirurgia', label: 'ISS Trauma', icon: 'activity', color: 'red', prompt: 'Injury Severity Score (ISS) baseado na escala AIS.' },
    { id: 'fast_exam', cat: 'Cirurgia', label: 'eFAST', icon: 'image', color: 'blue', prompt: 'Roteiro de interpretação eFAST no trauma.' },
    { id: 'ogilvie', cat: 'Cirurgia', label: 'Ogilvie', icon: 'alert-octagon', color: 'orange', prompt: 'Manejo da Síndrome de Ogilvie (Pseudo-obstrução colônica).' },
    { id: 'aaa_rupture', cat: 'Cirurgia', label: 'Risco AAA', icon: 'activity', color: 'red', prompt: 'Risco de ruptura de Aneurisma de Aorta Abdominal baseado no diâmetro.' },

    // --- Pediatria (Expansão) ---
    { id: 'ballard_score', cat: 'Pediatria', label: 'Ballard', icon: 'baby', color: 'pink', prompt: 'Estime a idade gestacional pelo Score de New Ballard.' },
    { id: 'bilirubin_nomogram', cat: 'Pediatria', label: 'Nomograma Bili', icon: 'sun', color: 'yellow', prompt: 'Risco de hiperbilirrubinemia (Nomograma de Bhutani).' },
    { id: 'snap_pe', cat: 'Pediatria', label: 'SNAP-PE', icon: 'activity', color: 'red', prompt: 'Score de gravidade neonatal SNAP-PE.' },
    { id: 'ped_appendicitis', cat: 'Pediatria', label: 'PAS Score', icon: 'alert-triangle', color: 'orange', prompt: 'Pediatric Appendicitis Score (PAS).' },
    { id: 'westley_croup', cat: 'Pediatria', label: 'Westley Crupe', icon: 'wind', color: 'blue', prompt: 'Score de Westley para gravidade do Crupe Viral.' },
    { id: 'yale_observation', cat: 'Pediatria', label: 'Escala Yale', icon: 'eye', color: 'green', prompt: 'Escala de Observação de Yale para febre em lactentes.' },
    { id: 'schwartz_gfr', cat: 'Pediatria', label: 'Schwartz TFG', icon: 'droplet', color: 'blue', prompt: 'TFG Pediátrica (Fórmula de Schwartz à beira do leito).' },

    // --- Ginecologia e Obstetrícia (Expansão) ---
    { id: 'vbac_calc', cat: 'Gineco', label: 'Calc VBAC', icon: 'activity', color: 'pink', prompt: 'Probabilidade de sucesso de Parto Vaginal após Cesárea (VBAC).' },
    { id: 'edinburgh_scale', cat: 'Gineco', label: 'Escala Edimburgo', icon: 'frown', color: 'purple', prompt: 'Rastreio de Depressão Pós-parto (Escala de Edimburgo).' },
    { id: 'manning_score', cat: 'Gineco', label: 'Perfil Biofísico', icon: 'baby', color: 'cyan', prompt: 'Perfil Biofísico Fetal (Manning).' },
    { id: 'roberts_criteria', cat: 'Gineco', label: 'Corioamnionite', icon: 'alert-triangle', color: 'red', prompt: 'Critérios diagnósticos para Corioamnionite Clínica.' },
    { id: 'ectopic_risk', cat: 'Gineco', label: 'Risco Ectópica', icon: 'alert-octagon', color: 'red', prompt: 'Sinais de alerta e fatores de risco para Gravidez Ectópica.' },
    { id: 'pearl_index', cat: 'Gineco', label: 'Índice Pearl', icon: 'shield', color: 'pink', prompt: 'Eficácia contraceptiva (Índice de Pearl).' },

    // --- Psiquiatria / Saúde Mental (Expansão) ---
    { id: 'panss_scale', cat: 'Psiquiatria', label: 'PANSS', icon: 'users', color: 'gray', prompt: 'Escala das Síndromes Positiva e Negativa (Esquizofrenia).' },
    { id: 'ymrs_mania', cat: 'Psiquiatria', label: 'YMRS', icon: 'zap', color: 'yellow', prompt: 'Escala de Mania de Young.' },
    { id: 'ham_d', cat: 'Psiquiatria', label: 'Hamilton-D', icon: 'frown', color: 'indigo', prompt: 'Escala de Depressão de Hamilton.' },
    { id: 'bec_anxiety', cat: 'Psiquiatria', label: 'Beck (BAI)', icon: 'activity', color: 'blue', prompt: 'Inventário de Ansiedade de Beck.' },
    { id: 'm_chat', cat: 'Psiquiatria', label: 'M-CHAT-R', icon: 'baby', color: 'green', prompt: 'Rastreio de Autismo em crianças (M-CHAT-R/F).' },
    { id: 'cage_substance', cat: 'Psiquiatria', label: 'CAGE', icon: 'wine', color: 'red', prompt: 'Questionário CAGE para abuso de álcool.' },
    { id: 'cow_opiate', cat: 'Psiquiatria', label: 'COWS', icon: 'activity', color: 'orange', prompt: 'Escala clínica de abstinência de opiáceos (COWS).' },

    // --- Ortopedia e Reumatologia (Expansão) ---
    { id: 'mirels_score', cat: 'Ortopedia', label: 'Score Mirels', icon: 'bone', color: 'yellow', prompt: 'Risco de fratura patológica em metástase óssea (Score de Mirels).' },
    { id: 'gustilo_anderson', cat: 'Ortopedia', label: 'Gustilo-Anderson', icon: 'alert-triangle', color: 'red', prompt: 'Classificação de fraturas expostas.' },
    { id: 'das28', cat: 'Reumato', label: 'DAS28', icon: 'activity', color: 'purple', prompt: 'Disease Activity Score 28 para Artrite Reumatoide.' },
    { id: 'spondylitis_asdas', cat: 'Reumato', label: 'ASDAS', icon: 'user', color: 'orange', prompt: 'Score de Atividade da Espondilite Anquilosante.' },
    { id: 'beighton_score', cat: 'Reumato', label: 'Beighton', icon: 'user', color: 'pink', prompt: 'Score de Beighton para hipermobilidade articular.' },
    { id: 'frax_tool', cat: 'Ortopedia', label: 'FRAX', icon: 'bar-chart', color: 'slate', prompt: 'Estimativa de risco de fratura osteoporótica (FRAX).' },

    // --- Dermatologia e Plástica (Expansão) ---
    { id: 'scorten', cat: 'Dermato', label: 'SCORTEN', icon: 'flame', color: 'red', prompt: 'Prognóstico na Necrólise Epidérmica Tóxica (NET/Stevens-Johnson).' },
    { id: 'pasi_score', cat: 'Dermato', label: 'PASI', icon: 'grid', color: 'pink', prompt: 'Índice de Área e Gravidade da Psoríase (PASI).' },
    { id: 'rule_of_nines', cat: 'Dermato', label: 'Regra dos 9', icon: 'user', color: 'orange', prompt: 'Estimativa de superfície corporal queimada (Regra dos 9 de Wallace).' },
    { id: 'pressure_ulcer', cat: 'Enfermagem', label: 'EPUAP/NPUAP', icon: 'layers', color: 'red', prompt: 'Estadiamento de lesões por pressão.' },

    // --- Genética (Novo) ---
    { id: 'pedigree_gen', cat: 'Genética', label: 'Heredograma', icon: 'git-branch', color: 'slate', prompt: 'Construa e interprete um heredograma baseado no relato: {s}.' },
    { id: 'hardy_weinberg', cat: 'Genética', label: 'Hardy-Weinberg', icon: 'calculator', color: 'blue', prompt: 'Cálculo de equilíbrio de Hardy-Weinberg.' },
    { id: 'bayes_risk', cat: 'Genética', label: 'Teorema Bayes', icon: 'percent', color: 'indigo', prompt: 'Cálculo de risco de recorrência genética usando Bayes.' },

    // --- Medicina Esportiva / Fisioterapia (Novo) ---
    { id: 'borg_scale', cat: 'Fisioterapia', label: 'Escala Borg', icon: 'activity', color: 'green', prompt: 'Escala de Percepção Subjetiva de Esforço de Borg.' },
    { id: 'tug_test', cat: 'Fisioterapia', label: 'TUG Test', icon: 'clock', color: 'orange', prompt: 'Interpretação do Timed Up and Go (risco de queda).' },
    { id: 'fms_screen', cat: 'Fisioterapia', label: 'FMS', icon: 'user-check', color: 'blue', prompt: 'Functional Movement Screen.' },
    { id: 'concussion_scat5', cat: 'Esporte', label: 'SCAT5', icon: 'brain', color: 'red', prompt: 'Avaliação de Concussão no Esporte (SCAT5).' },

    // --- Geriatria (Expansão) ---
    { id: 'katz_index', cat: 'Geriatria', label: 'Índice Katz', icon: 'user', color: 'green', prompt: 'Índice de Katz para Atividades de Vida Diária (AVD).' },
    { id: 'lawton_brody', cat: 'Geriatria', label: 'Lawton-Brody', icon: 'shopping-bag', color: 'blue', prompt: 'Escala de Lawton e Brody para AIVD.' },
    { id: 'mini_cog', cat: 'Geriatria', label: 'Mini-Cog', icon: 'clock', color: 'slate', prompt: 'Rastreio cognitivo rápido (Mini-Cog).' },
    { id: 'start_stop', cat: 'Geriatria', label: 'START/STOPP', icon: 'pill', color: 'red', prompt: 'Critérios START/STOPP para prescrição em idosos.' },

    // --- Radiologia / Diagnóstico por Imagem (Novo/Expansão) ---
    { id: 'lirads', cat: 'Radiologia', label: 'LI-RADS', icon: 'circle', color: 'orange', prompt: 'Sistema LI-RADS para lesões hepáticas.' },
    { id: 'tirads', cat: 'Radiologia', label: 'TI-RADS', icon: 'circle', color: 'purple', prompt: 'Classificação TI-RADS ACR para nódulos tireoidianos.' },
    { id: 'pi_rads', cat: 'Radiologia', label: 'PI-RADS', icon: 'circle', color: 'blue', prompt: 'Classificação PI-RADS v2.1 para próstata.' },
    { id: 'bosniak', cat: 'Radiologia', label: 'Bosniak', icon: 'circle', color: 'yellow', prompt: 'Classificação de Bosniak para cistos renais.' },
    { id: 'fleischner_soc', cat: 'Radiologia', label: 'Fleischner', icon: 'lungs', color: 'gray', prompt: 'Diretrizes da Fleischner Society para nódulos pulmonares incidentais.' },

    // --- Administrativo / Legislação (Novo) ---
    { id: 'icd_10_lookup', cat: 'Admin', label: 'Busca CID-10', icon: 'search', color: 'slate', prompt: 'Encontre o código CID-10 mais específico para: {s}.' },
    { id: 'medical_cert_rules', cat: 'Admin', label: 'Regras Atestado', icon: 'file-text', color: 'slate', prompt: 'Normas do CFM sobre emissão de atestados médicos.' },
    { id: 'death_cert', cat: 'Admin', label: 'Atestado Óbito', icon: 'file-text', color: 'gray', prompt: 'Como preencher corretamente a Declaração de Óbito (Causa básica vs terminal).' },

    // --- Nutrologia (Expansão) ---
    { id: 'harris_benedict', cat: 'Nutrição', label: 'Harris-Benedict', icon: 'calculator', color: 'green', prompt: 'Calcule o Gasto Energético Basal (Harris-Benedict) para: {o}.' },
    { id: 'mifflin_st_jeor', cat: 'Nutrição', label: 'Mifflin-St Jeor', icon: 'calculator', color: 'green', prompt: 'Calcule o Gasto Energético (Mifflin-St Jeor) - mais preciso para obesos.' },
    { id: 'refeeding_risk', cat: 'Nutrição', label: 'Sínd. Realim.', icon: 'alert-triangle', color: 'red', prompt: 'Avalie o risco de Síndrome de Realimentação e conduta profilática.' },

    // --- Oftalmologia (Expansão) ---
    { id: 'glaucoma_risk', cat: 'Oftalmo', label: 'Risco Glaucoma', icon: 'eye', color: 'blue', prompt: 'Fatores de risco e alvo pressórico no Glaucoma.' },
    { id: 'dr_classification', cat: 'Oftalmo', label: 'Retinopatia Diab.', icon: 'eye', color: 'red', prompt: 'Classificação internacional da Retinopatia Diabética.' },

    // --- Otorrinolaringologia (Expansão) ---
    { id: 'fleming_score', cat: 'Otorrino', label: 'Fleming (Epiglote)', icon: 'activity', color: 'red', prompt: 'Classificação de Fleming para Epiglotite Aguda.' },
    { id: 'tonsil_grade', cat: 'Otorrino', label: 'Grau Amígdala', icon: 'circle', color: 'pink', prompt: 'Classificação de Brodsky para hipertrofia tonsilar.' },

    // --- Toxicologia (Expansão) ---
    { id: 'toxidromes', cat: 'Toxico', label: 'Toxidromes', icon: 'skull', color: 'purple', prompt: 'Identifique a toxíndrome (Colinérgica, Anticolinérgica, Opioide, Simpaticomimética) baseada em: {s} {o}.' },
    { id: 'rumack_matthew', cat: 'Toxico', label: 'Rumack-Matthew', icon: 'bar-chart', color: 'green', prompt: 'Interprete o nomograma de Rumack-Matthew para paracetamol. Tempo: {val}, Nível: {val}.' },
    { id: 'anion_osmolar_gap', cat: 'Toxico', label: 'Gap Osmolar', icon: 'droplet', color: 'blue', prompt: 'Cálculo do Gap Osmolar para suspeita de álcoois tóxicos.' },

    // --- Cálculos Gerais / Diversos ---
    { id: 'bmi_calc', cat: 'Geral', label: 'IMC', icon: 'user', color: 'green', prompt: 'Calcule o IMC e classifique. Peso: {val}, Altura: {val}.' },
    { id: 'bsa_calc', cat: 'Geral', label: 'Sup. Corpórea', icon: 'maximize', color: 'blue', prompt: 'Cálculo de Superfície Corpórea (Mosteller/DuBois).' },
    { id: 'ideal_weight', cat: 'Geral', label: 'Peso Ideal', icon: 'user', color: 'green', prompt: 'Cálculo de Peso Ideal e Peso Ajustado.' },
    { id: 'number_needed_treat', cat: 'EBM', label: 'NNT Calc', icon: 'calculator', color: 'indigo', prompt: 'Calcule o NNT (Number Needed to Treat) dado o RRR e risco basal.' },
    { id: 'lr_calc', cat: 'EBM', label: 'Likelihood Ratio', icon: 'bar-chart-2', color: 'slate', prompt: 'Calcule a Razão de Verossimilhança (LR+ e LR-) dados Sensibilidade e Especificidade.' }
];


        const app = (function() {
            let state = {
                meds: [], 
                exams: [],
                config: JSON.parse(localStorage.getItem('neuro_config')) || { name: 'Dr. Médico', crm: '00000', address: 'Endereço da Clínica', phone: '(00) 0000-0000' },
                prescription: [], 
                examRequest: [], 
                hospitalLines: Array.from({length: 20}, (_, i) => ({ id: i, text: "" })), 
                activeDocument: 'prescription', 
                searchTimeout: null,
                logoData: localStorage.getItem('neuro_logo') || null
            };

            // ... (RESTANTE DAS FUNÇÕES MANTIDO IGUAL PARA GARANTIR FUNCIONAMENTO) ...
            // Apenas a função callAI e generateMagicSoap precisaram da atualização de system prompt feita acima.
            // Vou recolocar todas as funções aqui para ser um copy-paste único.

            function init() {
                loadDatabase();
                lucide.createIcons();
                updateDocumentView();
                renderAITools();
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('calcUsgDate').max = today;
                document.getElementById('calcDum').max = today;
                updateConfigUI();
            }

            function loadDatabase() {
                const lines = COMPRESSED_DB.split('\n').map(l => l.trim()).filter(l => l.length > 0);
                lines.forEach(line => {
                    const parts = line.split('|');
                    if (parts[0] === 'M') { state.meds.push({ name: parts[1], dose: parts[2], instr: parts[3], cat: parts[4], id: Math.random().toString(36).substr(2, 9) }); }
                    if (parts[0] === 'E') { state.exams.push({ name: parts[1], type: parts[2], cat: parts[3], id: Math.random().toString(36).substr(2, 9) }); }
                });
            }

            function searchDatabase(type, query) {
                const indicator = document.getElementById('loadingIndicator');
                const list = type === 'med' ? document.getElementById('medicationList') : document.getElementById('examList');
                if (state.searchTimeout) clearTimeout(state.searchTimeout);
                if (!query) {
                    list.innerHTML = `<div class="flex flex-col items-center justify-center h-40 text-slate-400 opacity-60"><i data-lucide="database" class="w-10 h-10 mb-2"></i><span class="text-xs font-medium">Digite para buscar</span></div>`;
                    lucide.createIcons();
                    return;
                }
                indicator.classList.remove('hidden'); indicator.classList.add('flex');
                state.searchTimeout = setTimeout(() => {
                    const lowerQ = query.toLowerCase();
                    let results = [];
                    if (type === 'med') { results = state.meds.filter(m => m.name.toLowerCase().includes(lowerQ) || m.cat.toLowerCase().includes(lowerQ)).slice(0, 50); renderMedResults(results); } 
                    else { results = state.exams.filter(e => e.name.toLowerCase().includes(lowerQ) || (e.cat && e.cat.toLowerCase().includes(lowerQ))).slice(0, 50); renderExamResults(results); }
                    indicator.classList.add('hidden'); indicator.classList.remove('flex');
                }, 300);
            }

            function renderMedResults(results) {
                const list = document.getElementById('medicationList');
                if (results.length === 0) { list.innerHTML = `<div class="p-4 text-center text-slate-400">Nada encontrado.</div>`; return; }
                list.innerHTML = results.map(m => `<button onclick="app.addItem('${m.id}', 'med')" class="w-full text-left p-3 rounded-xl bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 hover:border-emerald-500 hover:shadow-sm transition group"><div class="flex justify-between"><span class="font-bold text-slate-700 dark:text-slate-200 group-hover:text-emerald-600">${m.name}</span><span class="text-[10px] bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-slate-500">${m.cat}</span></div><div class="text-xs text-slate-400 mt-1">${m.dose} • ${m.instr}</div></button>`).join('');
            }

            function renderExamResults(results) {
                const list = document.getElementById('examList');
                if (results.length === 0) { list.innerHTML = `<div class="p-4 text-center text-slate-400">Nada encontrado.</div>`; return; }
                list.innerHTML = results.map(e => `<button onclick="app.addItem('${e.id}', 'exam')" class="w-full text-left p-3 rounded-xl bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 hover:border-orange-500 hover:shadow-sm transition group"><div class="flex justify-between items-center"><span class="font-bold text-slate-700 dark:text-slate-200 group-hover:text-orange-600">${e.name}</span><span class="text-[10px] uppercase font-bold text-slate-400">${e.cat || 'Geral'}</span></div><div class="text-xs text-slate-400 mt-1">${e.type}</div></button>`).join('');
            }

            function addItem(id, type) {
                if(type === 'med') {
                    const item = state.meds.find(i => i.id === id);
                    if(item) {
                        state.prescription.push({ ...item, uid: Date.now() });
                        if(state.activeDocument === 'hospital') {
                            const emptyLine = state.hospitalLines.find(l => l.text === "");
                            if(emptyLine) emptyLine.text = `${item.name} ${item.dose} - ${item.instr}`;
                            else state.hospitalLines.push({ id: Date.now(), text: `${item.name} ${item.dose} - ${item.instr}` });
                        } else setDocumentMode('prescription');
                    }
                } else {
                    const item = state.exams.find(i => i.id === id);
                    if(item) {
                        state.examRequest.push({ ...item, uid: Date.now() });
                        setDocumentMode('exams');
                    }
                }
                updateDocumentView();
            }

            function removeItem(uid, type) {
                if(type === 'med') state.prescription = state.prescription.filter(i => i.uid != uid);
                else state.examRequest = state.examRequest.filter(i => i.uid != uid);
                updateDocumentView();
            }

            function updateHospitalLine(id, value) { const line = state.hospitalLines.find(l => l.id === id); if(line) line.text = value.toUpperCase(); }
            function addHospitalLine() { state.hospitalLines.push({ id: Date.now(), text: "" }); updateDocumentView(); }
            function removeHospitalLine(id) { state.hospitalLines = state.hospitalLines.filter(l => l.id !== id); updateDocumentView(); }

            function renderAITools(filter = '') {
                const container = document.getElementById('aiToolsContainer');
                container.innerHTML = '';
                const filtered = AI_LIBRARY.filter(t => t.label.toLowerCase().includes(filter.toLowerCase()) || t.cat.toLowerCase().includes(filter.toLowerCase()));
                const cats = [...new Set(filtered.map(t => t.cat))];
                cats.forEach(cat => {
                    const section = document.createElement('div');
                    section.innerHTML = `<h3 class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-3 ml-1 flex items-center gap-2">${cat}</h3>`;
                    const grid = document.createElement('div'); grid.className = 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3';
                    grid.innerHTML = filtered.filter(t => t.cat === cat).map(t => {
                        const theme = { bg: `bg-${t.color}-100 dark:bg-${t.color}-900/30`, text: `text-${t.color}-800 dark:text-${t.color}-200`, hover: `hover:bg-${t.color}-200 dark:hover:bg-${t.color}-900/50` };
                        return `<button onclick="app.callAI('${t.id}')" class="ai-card group flex flex-col items-start justify-between p-3 h-[70px] w-full rounded-xl ${theme.bg} ${theme.text} ${theme.hover} cursor-pointer"><div class="w-full flex justify-start"><i data-lucide="${t.icon}" class="w-5 h-5"></i></div><span class="text-[11px] font-bold text-left leading-tight w-full truncate mt-1">${t.label}</span></button>`
                    }).join('');
                    section.appendChild(grid); container.appendChild(section);
                });
                lucide.createIcons();
            }
            function filterAITools() { renderAITools(document.getElementById('aiToolSearch').value); }

            async function callAI(toolId) {
                if(!state.config.apiKey) { alert("Configure a API Key!"); openModal('configModal'); return; }
                const tool = AI_LIBRARY.find(t => t.id === toolId);
                
                // PREPARAÇÃO DO PROMPT
                const s = document.getElementById('soapS').value; const o = document.getElementById('soapO').value;
                const a = document.getElementById('soapA').value; const p = document.getElementById('soapP').value;
                const meds = state.prescription.map(m => `${m.name} ${m.dose}`).join(', ');
                let promptText = tool.prompt.replace('{s}', s||'NI').replace('{o}', o||'NI').replace('{a}', a||'NI').replace('{p}', p||'NI').replace('{soap}', `S: ${s}\nO: ${o}\nA: ${a}\nP: ${p}`).replace('{meds}', meds||'Nenhuma');

                // UI FEEDBACK
                document.getElementById('aiModalTitle').innerText = tool.label;
                document.getElementById('aiModalContent').innerHTML = '<div class="flex justify-center py-10"><i data-lucide="loader" class="w-8 h-8 animate-spin text-indigo-600"></i></div>';
                openModal('aiModal'); lucide.createIcons();

                // LÓGICA DE IMAGEM VS TEXTO
                if (tool.type === 'image') {
                    try {
                        // Chamada para o modelo de IMAGEM (Imagen 3 / Nano Banana)
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-001:predict?key=${state.config.apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                instances: [{ prompt: promptText }],
                                parameters: { sampleCount: 1 }
                            })
                        });
                        const data = await response.json();
                        
                        if (data.predictions && data.predictions[0]) {
                            const imgBase64 = data.predictions[0].bytesBase64Encoded;
                            const imgUrl = `data:image/png;base64,${imgBase64}`;
                            document.getElementById('aiModalContent').innerHTML = `<div class="flex flex-col items-center"><img src="${imgUrl}" class="rounded-lg shadow-lg max-w-full border border-slate-200"><a href="${imgUrl}" download="ilustracao_didatica.png" class="mt-4 text-indigo-600 underline text-sm">Baixar Imagem</a></div>`;
                        } else {
                             // Fallback para erro ou resposta inesperada
                            console.error(data);
                            document.getElementById('aiModalContent').innerHTML = `<p class="text-red-500">Erro ao gerar imagem. Verifique a API Key ou tente novamente.</p>`;
                        }
                    } catch(e) {
                        document.getElementById('aiModalContent').innerHTML = `<p class="text-red-500">Erro: ${e.message}</p>`;
                    }
                } else {
                    // Chamada para o modelo de TEXTO (Gemini Flash)
                    const systemContext = "ATENÇÃO: Você é um assistente de decisão clínica para médicos. Suas respostas DEVEM ser baseadas estritamente em diretrizes clínicas oficiais e literatura médica confiável (Ex: Ministério da Saúde do Brasil, USP/HC-FMUSP, SBC, ADA, GINA, GOLD). Para HIPERTENSÃO, priorize as diretrizes do Congresso Europeu (ESH/ESC) mais recentes. Para IAM/SCA, priorize as diretrizes ESC e SBC atuais. Sempre cite a diretriz base utilizada. Se não houver evidência robusta, informe. Não gere alucinações ou 'achismos'. Responda com estrutura técnica, doses precisas (quando aplicável) e referências.";
                    
                    promptText += "\n\nIMPORTANTE: Responda em HTML usando classes TailwindCSS. NÃO use Markdown.";

                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${state.config.apiKey}`, {
                            method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: systemContext + "\n\n" + promptText }] }] })
                        });
                        const data = await response.json();
                        let html = data.candidates?.[0]?.content?.parts?.[0]?.text || "<p class='text-red-500'>Erro na geração.</p>";
                        document.getElementById('aiModalContent').innerHTML = html.replace(/```html|```/g, '');
                    } catch(e) { document.getElementById('aiModalContent').innerHTML = `<p class="text-red-500">Erro: ${e.message}</p>`; }
                }
            }

            async function generateMagicSoap() { 
                if(!state.config.apiKey) return alert("Sem API Key"); 
                const txt = document.getElementById('magicSoapInput').value; 
                const btn = document.querySelector('#magicSoapModal button[onclick="app.generateMagicSoap()"]'); 
                const old = btn.innerHTML; btn.innerHTML = 'Processando...'; 
                const systemContext = "ATENÇÃO: Extraia um SOAP estruturado formal com base em terminologia médica padrão (SNOMED/CID-10). Não invente dados.";
                try { 
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${state.config.apiKey}`, { 
                        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: systemContext + "\nExtraia SOAP JSON (chaves: s,o,a,p) de: " + txt }] }] }) 
                    }); 
                    const data = await response.json(); 
                    const jsonText = data.candidates?.[0]?.content?.parts?.[0]?.text.replace(/```json|```/g, '');
                    const json = JSON.parse(jsonText); 
                    document.getElementById('soapS').value = json.s||''; document.getElementById('soapO').value = json.o||''; 
                    document.getElementById('soapA').value = json.a||''; document.getElementById('soapP').value = json.p||''; 
                    closeModal('magicSoapModal'); 
                } catch(e) { alert("Erro ao processar"); } finally { btn.innerHTML = old; } 
            }

            function updateDocumentView() {
                const doc = document.getElementById('prescriptionPaper');
                const pName = document.getElementById('patientNameInput').value || "_______________________";
                const date = new Date().toLocaleDateString('pt-BR');
                const config = state.config;
                if (state.activeDocument === 'hospital') { doc.className = 'print-container paper-a4-landscape shadow-paper relative flex flex-col ring-1 ring-black/5 origin-top scale-[0.65] lg:scale-100'; } 
                else { doc.className = 'print-container paper-a5 shadow-paper relative flex flex-col ring-1 ring-black/5 origin-top scale-[0.85] lg:scale-100'; }
                const logoHtml = state.logoData ? `<img src="${state.logoData}" alt="Logo" onclick="document.getElementById('logoUploadInput').click()">` : `<div class="text-xs text-center text-gray-400">LOGO<br>(Clique)</div>`;
                const headerHtml = `<div class="doc-header"><div style="display: flex; gap: 15px; align-items: center;"><div class="doc-logo-area" onclick="document.getElementById('logoUploadInput').click()">${logoHtml}</div><div style="flex:1"><div class="doc-name">${config.name}</div><div class="text-sm mt-1">${config.address} • ${config.phone}</div></div></div><div class="doc-meta"><strong>DATA:</strong> ${date}<br><strong>CRM/RQE:</strong> ${config.crm}</div></div><div style="margin-bottom: 20px;"><strong>PACIENTE:</strong> <span style="font-size: 14pt; text-transform: uppercase; margin-left: 5px;">${pName}</span></div>`;
                const footerHtml = `<div class="doc-footer"><div style="border-top: 1px solid #000; width: 250px; margin: 0 auto 5px auto;"></div><div style="font-weight: bold; font-size: 11pt;">${config.name}</div><div>${config.crm}</div><div style="margin-top: 5px; font-size: 8pt; color:#999">Gerado via NeuroScript</div></div>`;
                let bodyHtml = '';
                if (state.activeDocument === 'hospital') {
                    const rows = state.hospitalLines.map((line, i) => `<div class="hospital-row group"><div class="hospital-num">${i+1}</div><input type="text" class="hospital-input" value="${line.text}" oninput="app.updateHospitalLine(${line.id}, this.value)"><button onclick="app.removeHospitalLine(${line.id})" class="no-print p-1 text-red-300 hover:text-red-600 opacity-0 group-hover:opacity-100 transition" title="Remover linha"><i data-lucide="trash-2" style="width: 14px; height: 14px;"></i></button></div>`).join('');
                    bodyHtml = `<h2 style="text-align: center; font-size: 14pt; font-weight: bold; text-transform: uppercase; border-bottom: 2px solid #000; margin-bottom: 10px; padding-bottom: 5px;">Prescrição Hospitalar</h2><div style="flex: 1; border: 1px solid #ccc; display: flex; flex-direction: column;">${rows}<div class="no-print p-2 text-center bg-slate-50 hover:bg-slate-100 cursor-pointer border-t border-slate-200 transition" onclick="app.addHospitalLine()"><span class="text-xs font-bold text-slate-500">+ Adicionar Linha</span></div></div>`;
                } else {
                    let listItems = ''; let title = '';
                    if(state.activeDocument === 'prescription') {
                        title = 'RECEITUÁRIO';
                        listItems = state.prescription.length ? state.prescription.map((m,i) => `<div style="margin-bottom: 15px; position: relative;" class="group"><div style="font-weight: bold; font-size: 12pt;">${i+1}. ${m.name} ${m.dose}</div><div style="padding-left: 20px; font-size: 11pt; font-style: italic;">${m.instr}</div><button onclick="app.removeItem(${m.uid},'med')" class="no-print absolute right-0 top-0 text-red-300 hover:text-red-600 opacity-0 group-hover:opacity-100"><i data-lucide="trash-2" style="width: 14px;"></i></button></div>`).join('') : '<div style="text-align: center; color: #ccc; margin-top: 50px;">Adicione medicamentos</div>';
                    } else {
                        title = 'SOLICITAÇÃO DE EXAMES';
                        listItems = state.examRequest.length ? `<ul style="list-style-type: disc; padding-left: 20px;">` + state.examRequest.map(e => `<li style="margin-bottom: 8px; position: relative;" class="group"><span style="font-size: 12pt;">${e.name}</span><button onclick="app.removeItem(${e.uid},'exam')" class="no-print absolute -right-5 top-0 text-red-300 hover:text-red-600 opacity-0 group-hover:opacity-100"><i data-lucide="trash-2" style="width: 14px;"></i></button></li>`).join('') + `</ul>` : '<div style="text-align: center; color: #ccc; margin-top: 50px;">Adicione exames</div>';
                    }
                    bodyHtml = `<h2 style="text-align: center; font-size: 14pt; font-weight: bold; text-transform: uppercase; border-bottom: 2px solid #000; margin-bottom: 20px;">${title}</h2><div style="flex: 1;">${listItems}</div>`;
                }
                doc.innerHTML = headerHtml + bodyHtml + footerHtml;
                lucide.createIcons();
            }

            function handleLogoUpload(input) { if (input.files && input.files[0]) { const reader = new FileReader(); reader.onload = function(e) { state.logoData = e.target.result; localStorage.setItem('neuro_logo', state.logoData); updateDocumentView(); }; reader.readAsDataURL(input.files[0]); } }
            function switchTab(id) { document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active')); document.getElementById('tabContent-'+id).classList.add('active'); document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active')); document.getElementById('tabButton-'+id).classList.add('active'); document.querySelectorAll('.nav-icon-btn').forEach(b => b.classList.remove('active')); const mbBtn = document.getElementById('mb-nav-'+id); if(mbBtn) mbBtn.classList.add('active'); if(id==='pharmacy') setDocumentMode('prescription'); if(id==='exams') setDocumentMode('exams'); }
            function setDocumentMode(mode) { state.activeDocument = mode; document.getElementById('docMode-prescription').className = mode==='prescription'?'doc-switch-btn active':'doc-switch-btn inactive'; document.getElementById('docMode-exams').className = mode==='exams'?'doc-switch-btn active':'doc-switch-btn inactive'; document.getElementById('docMode-hospital').className = mode==='hospital'?'doc-switch-btn active':'doc-switch-btn inactive'; updateDocumentView(); }
            function toggleMobileDoc() { const p = document.getElementById('documentPanel'); const nav = document.getElementById('mobileBottomNav'); if (p.classList.contains('hidden')) { p.classList.remove('hidden', 'lg:flex'); p.classList.add('mobile-fullscreen'); nav.style.display = 'none'; document.getElementById('mainHeader').style.display = 'none'; } else { p.classList.add('hidden', 'lg:flex'); p.classList.remove('mobile-fullscreen'); nav.style.display = 'flex'; document.getElementById('mainHeader').style.display = 'flex'; } }
            function toggleTheme() { document.documentElement.classList.toggle('dark'); }
            function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
            function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
            function generatePDF() { const el = document.getElementById('prescriptionPaper'); const isHospital = state.activeDocument === 'hospital'; const opt = { margin: 0, filename: state.activeDocument + '.pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2, useCORS: true }, jsPDF: { unit: 'mm', format: isHospital ? 'a4' : 'a5', orientation: isHospital ? 'landscape' : 'portrait' } }; html2pdf().set(opt).from(el).save(); }
            function saveConfig() { state.config.name = document.getElementById('cfgName').value; state.config.crm = document.getElementById('cfgCrm').value; state.config.address = document.getElementById('cfgAddress').value; state.config.phone = document.getElementById('cfgPhone').value; state.config.apiKey = document.getElementById('apiKeyInput').value; localStorage.setItem('neuro_config', JSON.stringify(state.config)); if(state.config.apiKey) document.getElementById('apiKeyStatus').classList.replace('bg-red-500','bg-emerald-500'); closeModal('configModal'); updateDocumentView(); }
            function updateConfigUI() { document.getElementById('cfgName').value = state.config.name; document.getElementById('cfgCrm').value = state.config.crm; document.getElementById('cfgAddress').value = state.config.address || ''; document.getElementById('cfgPhone').value = state.config.phone || ''; document.getElementById('apiKeyInput').value = state.config.apiKey || ''; if(state.config.apiKey) document.getElementById('apiKeyStatus').classList.replace('bg-red-500','bg-emerald-500'); }
            function copyAIContent() { const r = document.createRange(); r.selectNode(document.getElementById('aiModalContent')); window.getSelection().removeAllRanges(); window.getSelection().addRange(r); document.execCommand('copy'); alert("Copiado!"); }
            function openMagicSoap() { openModal('magicSoapModal'); }
            function handleExamUpload() { alert("Simulado"); }
            function clearPatientData() { document.getElementById('patientNameInput').value=''; document.getElementById('soapS').value=''; document.getElementById('soapO').value=''; document.getElementById('soapA').value=''; document.getElementById('soapP').value=''; state.prescription=[]; state.examRequest=[]; state.hospitalLines=Array.from({length: 20}, (_, i) => ({ id: i, text: "" })); updateDocumentView(); }
            function calcObs() { const today = new Date(); today.setHours(0,0,0,0); const dumVal = document.getElementById('calcDum').value; if(dumVal) { const dumDate = new Date(dumVal + 'T00:00:00'); const diffDays = Math.floor((today - dumDate) / (1000 * 60 * 60 * 24)); const dpp = new Date(dumDate); dpp.setDate(dumDate.getDate() + 280); document.getElementById('resIgDum').innerText = `${Math.floor(diffDays/7)}s ${diffDays%7}d`; document.getElementById('resDppDum').innerText = `DPP: ${dpp.toLocaleDateString('pt-BR')}`; } const usgVal = document.getElementById('calcUsgDate').value; const usgW = parseInt(document.getElementById('calcUsgW').value)||0; const usgD = parseInt(document.getElementById('calcUsgD').value)||0; if(usgVal && usgW) { const usgDate = new Date(usgVal + 'T00:00:00'); const conceptionDate = new Date(usgDate); conceptionDate.setDate(conceptionDate.getDate() - ((usgW*7)+usgD)); const diffDays = Math.floor((today - conceptionDate) / (1000 * 60 * 60 * 24)); const dpp = new Date(conceptionDate); dpp.setDate(conceptionDate.getDate() + 280); document.getElementById('resIgUsg').innerText = `${Math.floor(diffDays/7)}s ${diffDays%7}d`; document.getElementById('resDppUsg').innerText = `DPP: ${dpp.toLocaleDateString('pt-BR')}`; } }
            function pasteIg(id) { document.getElementById('soapA').value += `\nIG: ${document.getElementById(id).innerText}`; closeModal('obstetricModal'); }

            return { init, searchDatabase, addItem, removeItem, calcObs, pasteIg, updateDocumentView, switchTab, setDocumentMode, toggleMobileDoc, toggleTheme, openModal, closeModal, generatePDF, saveConfig, copyAIContent, callAI, renderAITools, filterAITools, openMagicSoap, generateMagicSoap, handleExamUpload, clearPatientData, updateHospitalLine, addHospitalLine, removeHospitalLine, handleLogoUpload };
        })();
        window.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
